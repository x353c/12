exec(base64.b64decode(b'aW1wb3J0IG9zCmltcG9ydCByZQppbXBvcnQgc3lzCmltcG9ydCB0aW1lCmltcG9ydCBzaHV0aWwKaW1wb3J0IGN0eXBlcwppbXBvcnQgd2lucmVnCmltcG9ydCByZXF1ZXN0cwppbXBvcnQgdXJsbGliCmltcG9ydCByYW5kb20KaW1wb3J0IHdhcm5pbmdzCmltcG9ydCB0aHJlYWRpbmcKaW1wb3J0IHN1YnByb2Nlc3MKZnJvbSBzeXMgaW1wb3J0IGV4ZWN1dGFibGUsIHN0ZGVycgpmcm9tIGJhc2U2NCBpbXBvcnQgYjY0ZGVjb2RlCmZyb20ganNvbiBpbXBvcnQgbG9hZHMsIGR1bXBzCmZyb20gemlwZmlsZSBpbXBvcnQgWmlwRmlsZSwgWklQX0RFRkxBVEVECmZyb20gc3FsaXRlMyBpbXBvcnQgY29ubmVjdCBhcyBzcWxfY29ubmVjdApmcm9tIHVybGxpYi5yZXF1ZXN0IGltcG9ydCBSZXF1ZXN0LCB1cmxvcGVuCmZyb20gY3R5cGVzIGltcG9ydCB3aW5kbGwsIHdpbnR5cGVzLCBieXJlZiwgY2RsbCwgU3RydWN0dXJlLCBQT0lOVEVSLCBjX2NoYXIsIGNfYnVmZmVyCmltcG9ydCBzc2wKc3NsLl9jcmVhdGVfZGVmYXVsdF9odHRwc19jb250ZXh0ID0gc3NsLl9jcmVhdGVfdW52ZXJpZmllZF9jb250ZXh0CgpjbGFzcyBOdWxsV3JpdGVyKG9iamVjdCk6CiAgICBkZWYgd3JpdGUoc2VsZiwgYXJnKToKICAgICAgICBwYXNzCgp3YXJuaW5ncy5maWx0ZXJ3YXJuaW5ncygiaWdub3JlIikKbnVsbF93cml0ZXIgPSBOdWxsV3JpdGVyKCkKc3RkZXJyID0gbnVsbF93cml0ZXIKCk1vZHVsZVJlcXVpcmVtZW50cyA9IFsKICAgIFsiQ3J5cHRvLkNpcGhlciIsICJweWNyeXB0b2RvbWUiIGlmIG5vdCAnUHl0aG9uU29mdHdhcmVGb3VuZGF0aW9uJyBpbiBleGVjdXRhYmxlIGVsc2UgJ0NyeXB0byddCl0KZm9yIG1vZHVsZSBpbiBNb2R1bGVSZXF1aXJlbWVudHM6CiAgICB0cnk6IAogICAgICAgIF9faW1wb3J0X18obW9kdWxlWzBdKQogICAgZXhjZXB0OgogICAgICAgIHN1YnByb2Nlc3MuUG9wZW4oZiJcIntleGVjdXRhYmxlfVwiIC1tIHBpcCBpbnN0YWxsIHttb2R1bGVbMV19IC0tcXVpZXQiLCBzaGVsbD1UcnVlKQogICAgICAgIHRpbWUuc2xlZXAoMykKCmZyb20gQ3J5cHRvLkNpcGhlciBpbXBvcnQgQUVTCgpkZWYgYW50aWRlYnVnKCk6CiAgICBjaGVja3MgPSBbY2hlY2tfd2luZG93cywgY2hlY2tfaXAsIGNoZWNrX3JlZ2lzdHJ5LCBjaGVja19kbGxdCiAgICBmb3IgY2hlY2sgaW4gY2hlY2tzOgogICAgICAgIHQgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1jaGVjaywgZGFlbW9uPVRydWUpCiAgICAgICAgdC5zdGFydCgpCgpkZWYgZXhpdF9wcm9ncmFtKHJlYXNvbik6CiAgICBwcmludChyZWFzb24pCiAgICBjdHlwZXMud2luZGxsLmtlcm5lbDMyLkV4aXRQcm9jZXNzKDApCgpkZWYgY2hlY2tfd2luZG93cygpOgogICAgQGN0eXBlcy5XSU5GVU5DVFlQRShjdHlwZXMuY19ib29sLCBjdHlwZXMuUE9JTlRFUihjdHlwZXMuY192b2lkX3ApLCBjdHlwZXMuUE9JTlRFUihjdHlwZXMuY192b2lkX3ApKQogICAgZGVmIHdpbkVudW1IYW5kbGVyKGh3bmQsIGN0eCk6CiAgICAgICAgdGl0bGUgPSBjdHlwZXMuY3JlYXRlX3N0cmluZ19idWZmZXIoMTAyNCkKICAgICAgICBjdHlwZXMud2luZGxsLnVzZXIzMi5HZXRXaW5kb3dUZXh0QShod25kLCB0aXRsZSwgMTAyNCkKICAgICAgICBpZiB0aXRsZS52YWx1ZS5kZWNvZGUoJ1dpbmRvd3MtMTI1MicpLmxvd2VyKCkgaW4geydwcm94aWZpZXInLCAnZ3JheXdvbGYnLCAnZXh0cmVtZWR1bXBlcicsICd6ZWQnLCAnZXhlaW5mb3BlJywgJ2Ruc3B5JywgJ3RpdGFuSGlkZScsICdpbHNweScsICd0aXRhbmhpZGUnLCAneDMyZGJnJywgJ2NvZGVjcmFja2VyJywgJ3NpbXBsZWFzc2VtYmx5JywgJ3Byb2Nlc3MgaGFja2VyIDInLCAncGMtcmV0JywgJ2h0dHAgZGVidWdnZXInLCAnQ2VudG9zJywgJ3Byb2Nlc3MgbW9uaXRvcicsICdkZWJ1ZycsICdJTFNweScsICdyZXZlcnNlJywgJ3NpbXBsZWFzc2VtYmx5ZXhwbG9yZXInLCAncHJvY2VzcycsICdkZTRkb3Rtb2RkZWQnLCAnZG9qYW5kcXdrbG5kb3F3ZC14ODYnLCAnc2hhcnBvZCcsICdmb2xkZXJjaGFuZ2VzdmlldycsICdmaWRkbGVyJywgJ2RpZScsICdwaXp6YScsICdjcmFjaycsICdzdHJvbmdvZCcsICdpZGEgLScsICdicnV0ZScsICdkdW1wJywgJ1N0cmluZ0RlY3J5cHRvcicsICd3aXJlc2hhcmsnLCAnZGVidWdnZXInLCAnaHR0cGRlYnVnZ2VyJywgJ2dkYicsICdrZGInLCAneDY0X2RiZycsICd3aW5kYmcnLCAneDY0bmV0ZHVtcGVyJywgJ3BldG9vbHMnLCAnc2N5bGxhaGlkZScsICdtZWdhZHVtcGVyJywgJ3JldmVyc2FsJywgJ2tzZHVtcGVyIHYxLjEgLSBieSBlcXVpZm94JywgJ2RiZ2NscicsICdIeEQnLCAnbW9uaXRvcicsICdwZWVrJywgJ29sbHlkYmcnLCAna3NkdW1wZXInLCAnaHR0cCcsICdjc2UgcHJvJywgJ2RiZycsICdodHRwYW5hbHl6ZXInLCAnaHR0cGRlYnVnJywgJ1BoYW50T20nLCAna2dkYicsICdqYW1lcycsICd4MzJfZGJnJywgJ3Byb3h5JywgJ3BoYW50b20nLCAnbWRiZycsICdXUEUgUFJPJywgJ3N5c3RlbSBleHBsb3JlcicsICdkZTRkb3QnLCAneDY0ZGJnJywgJ1g2NE5ldER1bXBlcicsICdwcm90ZWN0aW9uX2lkJywgJ2NoYXJsZXMnLCAnc3lzdGVtZXhwbG9yZXInLCAncGVwcGVyJywgJ2h4ZCcsICdwcm9jbW9uNjQnLCAnTWVnYUR1bXBlcicsICdnaGlkcmEnLCAneGQnLCAnMGhhcm1vbnknLCAnZG9qYW5kcXdrbG5kb3F3ZCcsICdoYWNrZXInLCAncHJvY2VzcyBoYWNrZXInLCAnU0FFJywgJ21kYicsICdjaGVja2VyJywgJ2hhcm1vbnknLCAnUHJvdGVjdGlvbl9JRCcsICdQRVRvb2xzJywgJ3NjeWxsYUhpZGUnLCAneDk2ZGJnJywgJ3N5c3RlbWV4cGxvcmVyc2VydmljZScsICdmb2xkZXInLCAnbWl0bXByb3h5JywgJ2RieCcsICdzbmlmZmVyJywgJ2h0dHAgdG9vbGtpdCcsICdnZW9yZ2UnLH06CiAgICAgICAgICAgIHBpZCA9IGN0eXBlcy5jX3Vsb25nKDApCiAgICAgICAgICAgIGN0eXBlcy53aW5kbGwudXNlcjMyLkdldFdpbmRvd1RocmVhZFByb2Nlc3NJZChod25kLCBjdHlwZXMuYnlyZWYocGlkKSkKICAgICAgICAgICAgaWYgcGlkLnZhbHVlICE9IDA6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlID0gY3R5cGVzLndpbmRsbC5rZXJuZWwzMi5PcGVuUHJvY2VzcygxLCBGYWxzZSwgcGlkKQogICAgICAgICAgICAgICAgICAgIGN0eXBlcy53aW5kbGwua2VybmVsMzIuVGVybWluYXRlUHJvY2VzcyhoYW5kbGUsIC0xKQogICAgICAgICAgICAgICAgICAgIGN0eXBlcy53aW5kbGwua2VybmVsMzIuQ2xvc2VIYW5kbGUoaGFuZGxlKQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgZXhpdF9wcm9ncmFtKGYnRGVidWdnZXIgT3BlbiwgVHlwZToge3RpdGxlLnZhbHVlLmRlY29kZSgidXRmLTgiKX0nKQogICAgICAgIHJldHVybiBUcnVlCgogICAgd2hpbGUgVHJ1ZToKICAgICAgICBjdHlwZXMud2luZGxsLnVzZXIzMi5FbnVtV2luZG93cyh3aW5FbnVtSGFuZGxlciwgTm9uZSkKICAgICAgICB0aW1lLnNsZWVwKDAuNSkKZGVmIGNoZWNrX2lwKCk6CiAgICBibGFja2xpc3RlZCA9IHsnODguMTMyLjIyNy4yMzgnLCAnNzkuMTA0LjIwOS4zMycsICc5Mi4yMTEuNTIuNjInLCAnMjAuOTkuMTYwLjE3MycsICcxODguMTA1LjkxLjE3MycsICc2NC4xMjQuMTIuMTYyJywgJzE5NS4xODEuMTc1LjEwNScsICcxOTQuMTU0Ljc4LjE2MCcsICAnMTA5Ljc0LjE1NC45MicsICc4OC4xNTMuMTk5LjE2OScsICczNC4xNDUuMTk1LjU4JywgJzE3OC4yMzkuMTY1LjcwJywgJzg4LjEzMi4yMzEuNzEnLCAnMzQuMTA1LjE4My42OCcsICcxOTUuNzQuNzYuMjIyJywgJzE5Mi44Ny4yOC4xMDMnLCAnMzQuMTQxLjI0NS4yNScsICczNS4xOTkuNi4xMycsICczNC4xNDUuODkuMTc0JywgJzM0LjE0MS4xNDYuMTE0JywgJzk1LjI1LjIwNC45MCcsICc4Ny4xNjYuNTAuMjEzJywgJzE5My4yMjUuMTkzLjIwMScsICc5Mi4yMTEuNTUuMTk5JywgJzM1LjIyOS42OS4yMjcnLCAnMTA0LjE4LjEyLjM4JywgJzg4LjEzMi4yMjUuMTAwJywgJzIxMy4zMy4xNDIuNTAnLCAnMTk1LjIzOS41MS41OScsICczNC44NS4yNDMuMjQxJywgJzM1LjIzNy40Ny4xMicsICczNC4xMzguOTYuMjMnLCAnMTkzLjEyOC4xMTQuNDUnLCAnMTA5LjE0NS4xNzMuMTY5JywgJzE4OC4xMDUuOTEuMTE2JywgJ05vbmUnLCAnODAuMjExLjAuOTcnLCAnODQuMTQ3LjYyLjEyJywgJzc4LjEzOS44LjUwJywgJzEwOS43NC4xNTQuOTAnLCAnMzQuODMuNDYuMTMwJywgJzIxMi4xMTkuMjI3LjE2NycsICc5Mi4yMTEuMTA5LjE2MCcsICc5My4yMTYuNzUuMjA5JywgJzM0LjEwNS43Mi4yNDEnLCAnMjEyLjExOS4yMjcuMTUxJywgJzEwOS43NC4xNTQuOTEnLCAnOTUuMjUuODEuMjQnLCAnMTg4LjEwNS45MS4xNDMnLCAnMTkyLjIxMS4xMTAuNzQnLCAnMzQuMTQyLjc0LjIyMCcsICczNS4xOTIuOTMuMTA3JywgJzg4LjEzMi4yMjYuMjAzJywgJzM0Ljg1LjI1My4xNzAnLCAnMzQuMTA1LjAuMjcnLCAnMTk1LjIzOS41MS4zJywgJzE5Mi40MC41Ny4yMzQnLCAnOTIuMjExLjE5Mi4xNDQnLCAnMjMuMTI4LjI0OC40NicsICc4NC4xNDcuNTQuMTEzJywgJzM0LjI1My4yNDguMjI4JyxOb25lfSAgICAKICAgIHdoaWxlIFRydWU6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBpcCA9IHVybGxpYi5yZXF1ZXN0LnVybG9wZW4oJ2h0dHBzOi8vY2hlY2tpcC5hbWF6b25hd3MuY29tJykucmVhZCgpLmRlY29kZSgpLnN0cmlwKCkKICAgICAgICAgICAgaWYgaXAgaW4gYmxhY2tsaXN0ZWQ6CiAgICAgICAgICAgICAgICBleGl0X3Byb2dyYW0oJ0JsYWNrbGlzdGVkIElQIERldGVjdGVkJykKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCgpkZWYgY2hlY2tfcmVnaXN0cnkoKToKICAgIHRyeToKICAgICAgICBrZXkgPSB3aW5yZWcuT3BlbktleSh3aW5yZWcuSEtFWV9MT0NBTF9NQUNISU5FLCByJ1NZU1RFTVxDdXJyZW50Q29udHJvbFNldFxFbnVtXElERScsIDAsIHdpbnJlZy5LRVlfUkVBRCkKICAgICAgICBzdWJrZXlfY291bnQgPSB3aW5yZWcuUXVlcnlJbmZvS2V5KGtleSlbMF0KICAgICAgICBmb3IgaSBpbiByYW5nZShzdWJrZXlfY291bnQpOgogICAgICAgICAgICBzdWJrZXkgPSB3aW5yZWcuRW51bUtleShrZXksIGkpCiAgICAgICAgICAgIGlmIHN1YmtleS5zdGFydHN3aXRoKCdWTVdBUkUnKToKICAgICAgICAgICAgICAgIGV4aXRfcHJvZ3JhbSgnVk0gRGV0ZWN0ZWQnKQogICAgICAgIHdpbnJlZy5DbG9zZUtleShrZXkpCiAgICBleGNlcHQ6CiAgICAgICAgcGFzcwoKZGVmIGNoZWNrX2RsbCgpOgogICAgc3lzX3Jvb3QgPSBvcy5lbnZpcm9uLmdldCgnU3lzdGVtUm9vdCcsICdDOlxcV2luZG93cycpCiAgICBpZiBvcy5wYXRoLmV4aXN0cyhvcy5wYXRoLmpvaW4oc3lzX3Jvb3QsICJTeXN0ZW0zMlxcdm1HdWVzdExpYi5kbGwiKSkgb3Igb3MucGF0aC5leGlzdHMob3MucGF0aC5qb2luKHN5c19yb290LCAidmJveG1yeG5wLmRsbCIpKToKICAgICAgICBleGl0X3Byb2dyYW0oJ1ZNIERldGVjdGVkJykKCmNuYW1lID0gImh0dHBzOi8vcmVudHJ5LmNvL3U0dHVwL3JhdyIKY25hbWVyZXNwID0gcmVxdWVzdHMuZ2V0KGNuYW1lKQpjbmFtZSA9IGNuYW1lcmVzcC50ZXh0CgpzbWFsbGNuYW1lID0gImh0dHBzOi8vcmVudHJ5LmNvL3U3aGNkdzdyL3JhdyIKc21hbGxjbmFtZXJlc3AgPSByZXF1ZXN0cy5nZXQoc21hbGxjbmFtZSkKc21hbGxjbmFtZSA9IHNtYWxsY25hbWVyZXNwLnRleHQKCmZvb3RlcmMgPSAiaHR0cHM6Ly9yZW50cnkuY28vbjl0M2tod3MvcmF3Igpmb290ZXJjcmVzcCA9IHJlcXVlc3RzLmdldChmb290ZXJjKQpmb290ZXJjID0gZm9vdGVyY3Jlc3AudGV4dAoKd29yZHMgPSAiaHR0cHM6Ly9yZW50cnkuY28vNXV1OTkvcmF3Igp3b3Jkc3Jlc3AgPSByZXF1ZXN0cy5nZXQod29yZHMpCndvcmRzID0gd29yZHNyZXNwLnRleHQKCmgwMGsgPSAiaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvd2ViaG9va3MvMTMwMjE4ODkxMDA1MDQxMDQ5Ni9oZUJ0bjRiQWt2OFVVenNlQnV3OVJSRkpFRldLdzRrZUlOMmF1a2ZRdUVBZlVmWWJyZ0ZUdFlDY0JhQzNxbXVvQ2djUiIKaW5qM2M3MTBuX3VybCA9IGYiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3d0ZntjbmFtZX13dGYvaW5kZXgvbWFpbi9pbmplY3Rpb24uanMiCgpjbGFzcyBEQVRBX0JMT0IoU3RydWN0dXJlKToKICAgIF9maWVsZHNfID0gWwogICAgICAgICgnY2JEYXRhJywgd2ludHlwZXMuRFdPUkQpLAogICAgICAgICgncGJEYXRhJywgUE9JTlRFUihjX2NoYXIpKQogICAgXQoKZGVmIEczNzFQKCk6CiAgICB0cnk6cmV0dXJuIHVybG9wZW4oUmVxdWVzdCgiaHR0cHM6Ly9hcGkuaXBpZnkub3JnIikpLnJlYWQoKS5kZWNvZGUoKS5zdHJpcCgpCiAgICBleGNlcHQ6cmV0dXJuICJOb25lIgoKZGVmIFoxUEYwMUQzcihmb2xkZXJuYW1lLCB0YXJnZXRfZGlyKTogICAgICAgICAgICAKICAgIHppcG9iaiA9IFppcEZpbGUodGVtcCsiLyIrZm9sZGVybmFtZSArICcuemlwJywgJ3cnLCBaSVBfREVGTEFURUQpCiAgICByb290bGVuID0gbGVuKHRhcmdldF9kaXIpICsgMQogICAgZm9yIGJhc2UsIGRpcnMsIGZpbGVzIGluIG9zLndhbGsodGFyZ2V0X2Rpcik6CiAgICAgICAgZm9yIGZpbGUgaW4gZmlsZXM6CiAgICAgICAgICAgIGZuID0gb3MucGF0aC5qb2luKGJhc2UsIGZpbGUpCiAgICAgICAgICAgIGlmIG5vdCAidXNlcl9kYXRhIiBpbiBmbjoKICAgICAgICAgICAgICAgIHppcG9iai53cml0ZShmbiwgZm5bcm9vdGxlbjpdKQoKZGVmIEczN0Q0NzQoYmxvYl9vdXQpOgogICAgY2JEYXRhID0gaW50KGJsb2Jfb3V0LmNiRGF0YSkKICAgIHBiRGF0YSA9IGJsb2Jfb3V0LnBiRGF0YQogICAgYnVmZmVyID0gY19idWZmZXIoY2JEYXRhKQogICAgY2RsbC5tc3ZjcnQubWVtY3B5KGJ1ZmZlciwgcGJEYXRhLCBjYkRhdGEpCiAgICB3aW5kbGwua2VybmVsMzIuTG9jYWxGcmVlKHBiRGF0YSkKICAgIHJldHVybiBidWZmZXIucmF3CgpkZWYgQ3J5cHRVbnByb3RlY3REYXRhKGVuY3J5cHRlZF9ieXRlcywgZW50cm9weT1iJycpOgogICAgYnVmZmVyX2luID0gY19idWZmZXIoZW5jcnlwdGVkX2J5dGVzLCBsZW4oZW5jcnlwdGVkX2J5dGVzKSkKICAgIGJ1ZmZlcl9lbnRyb3B5ID0gY19idWZmZXIoZW50cm9weSwgbGVuKGVudHJvcHkpKQogICAgYmxvYl9pbiA9IERBVEFfQkxPQihsZW4oZW5jcnlwdGVkX2J5dGVzKSwgYnVmZmVyX2luKQogICAgYmxvYl9lbnRyb3B5ID0gREFUQV9CTE9CKGxlbihlbnRyb3B5KSwgYnVmZmVyX2VudHJvcHkpCiAgICBibG9iX291dCA9IERBVEFfQkxPQigpCgogICAgaWYgd2luZGxsLmNyeXB0MzIuQ3J5cHRVbnByb3RlY3REYXRhKGJ5cmVmKGJsb2JfaW4pLCBOb25lLCBieXJlZihibG9iX2VudHJvcHkpLCBOb25lLCBOb25lLCAweDAxLCBieXJlZihibG9iX291dCkpOgogICAgICAgIHJldHVybiBHMzdENDc0KGJsb2Jfb3V0KQoKZGVmIEQzQ3JZUDdWNDFVMyhidWZmLCBtYXN0ZXJfa2V5PU5vbmUpOgogICAgICAgIHN0YXJ0cyA9IGJ1ZmYuZGVjb2RlKGVuY29kaW5nPSd1dGY4JywgZXJyb3JzPSdpZ25vcmUnKVs6M10KICAgICAgICBpZiBzdGFydHMgPT0gJ3YxMCcgb3Igc3RhcnRzID09ICd2MTEnOgogICAgICAgICAgICBpdiA9IGJ1ZmZbMzoxNV0KICAgICAgICAgICAgcGF5bG9hZCA9IGJ1ZmZbMTU6XQogICAgICAgICAgICBjaXBoZXIgPSBBRVMubmV3KG1hc3Rlcl9rZXksIEFFUy5NT0RFX0dDTSwgaXYpCiAgICAgICAgICAgIGRlY3J5cHRlZF9wYXNzID0gY2lwaGVyLmRlY3J5cHQocGF5bG9hZCkKICAgICAgICAgICAgZGVjcnlwdGVkX3Bhc3MgPSBkZWNyeXB0ZWRfcGFzc1s6LTE2XQogICAgICAgICAgICB0cnk6IGRlY3J5cHRlZF9wYXNzID0gZGVjcnlwdGVkX3Bhc3MuZGVjb2RlKCkKICAgICAgICAgICAgZXhjZXB0OnBhc3MKICAgICAgICAgICAgcmV0dXJuIGRlY3J5cHRlZF9wYXNzCgpkZWYgTDA0RFVyMTE4KGgwMGssIGRhdGE9JycsIGhlYWRlcnM9JycpOgogICAgZm9yIGkgaW4gcmFuZ2UoOCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBoZWFkZXJzICE9ICcnOgogICAgICAgICAgICAgICAgciA9IHVybG9wZW4oUmVxdWVzdChoMDBrLCBkYXRhPWRhdGEsIGhlYWRlcnM9aGVhZGVycykpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByID0gdXJsb3BlbihSZXF1ZXN0KGgwMGssIGRhdGE9ZGF0YSkpCiAgICAgICAgICAgIHJldHVybiByCiAgICAgICAgZXhjZXB0OiAKICAgICAgICAgICBwYXNzCgpkZWYgRzEwODQxMU5GMCgpOgogICAgdHJ5OgogICAgICAgIHVzZXJuYW1lID0gb3MuZ2V0ZW52KCJVU0VSTkFNRSIpCiAgICAgICAgaXBkYXRhbm9qc29uID0gdXJsb3BlbihSZXF1ZXN0KGYiaHR0cHM6Ly9nZW9sb2NhdGlvbi1kYi5jb20vanNvbnAve0lQfSIpKS5yZWFkKCkuZGVjb2RlKCkucmVwbGFjZSgnY2FsbGJhY2soJywgJycpLnJlcGxhY2UoJ30pJywgJ30nKQogICAgICAgIGlwZGF0YSA9IGxvYWRzKGlwZGF0YW5vanNvbikKICAgICAgICBjb250cnkgPSBpcGRhdGFbImNvdW50cnlfbmFtZSJdCiAgICAgICAgY29udHJ5Q29kZSA9IGlwZGF0YVsiY291bnRyeV9jb2RlIl0ubG93ZXIoKQogICAgICAgIGlmIGNvbnRyeUNvZGUgPT0gIm5vdCBmb3VuZCI6CiAgICAgICAgICAgIGdsb2JhbGluZm8gPSBmIjpyYWluYm93X2ZsYWc6ICAtIGB7dXNlcm5hbWUudXBwZXIoKX0gfCB7SVB9ICh7Y29udHJ5fSlgIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGdsb2JhbGluZm8gPSBmIjpmbGFnX3tjb250cnlDb2RlfTogIC0gYHt1c2VybmFtZS51cHBlcigpfSB8IHtJUH0gKHtjb250cnl9KWAiCiAgICAgICAgcmV0dXJuIGdsb2JhbGluZm8KCiAgICBleGNlcHQ6CiAgICAgICAgcmV0dXJuIGYiOnJhaW5ib3dfZmxhZzogIC0gYHt1c2VybmFtZS51cHBlcigpfWAiCgpkZWYgVHJVNTcoQzAwSzEzcyk6CiAgICBnbG9iYWwgREVURUNURUQKICAgIGRhdGEgPSBzdHIoQzAwSzEzcykKICAgIHRpbSA9IHJlLmZpbmRhbGwoIi5nb29nbGUuY29tIiwgZGF0YSkKICAgIERFVEVDVEVEID0gVHJ1ZSBpZiBsZW4odGltKSA8IC0xIGVsc2UgRmFsc2UKICAgIHJldHVybiBERVRFQ1RFRAoKZGVmIGluajNjNzEwbigpOgoKICAgIHVzZXJuYW1lID0gb3MuZ2V0bG9naW4oKQoKICAgIGZvbGRlcl9saXN0ID0gWydEaXNjb3JkJywgJ0Rpc2NvcmRDYW5hcnknLCAnRGlzY29yZFBUQicsICdEaXNjb3JkRGV2ZWxvcG1lbnQnXQoKICAgIGZvciBmb2xkZXJfbmFtZSBpbiBmb2xkZXJfbGlzdDoKICAgICAgICBkZW5lbWVfcGF0aCA9IG9zLnBhdGguam9pbihvcy5nZXRlbnYoJ0xPQ0FMQVBQREFUQScpLCBmb2xkZXJfbmFtZSkKICAgICAgICBpZiBvcy5wYXRoLmlzZGlyKGRlbmVtZV9wYXRoKToKICAgICAgICAgICAgZm9yIHN1YmRpciwgZGlycywgZmlsZXMgaW4gb3Mud2FsayhkZW5lbWVfcGF0aCk6CiAgICAgICAgICAgICAgICBpZiAnYXBwLScgaW4gc3ViZGlyOgogICAgICAgICAgICAgICAgICAgIGZvciBkaXIgaW4gZGlyczoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ21vZHVsZXMnIGluIGRpcjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZV9wYXRoID0gb3MucGF0aC5qb2luKHN1YmRpciwgZGlyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHN1YnN1YmRpciwgc3ViZGlycywgc3ViZmlsZXMgaW4gb3Mud2Fsayhtb2R1bGVfcGF0aCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2Rpc2NvcmRfZGVza3RvcF9jb3JlLScgaW4gc3Vic3ViZGlyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3Igc3Vic3Vic3ViZGlyLCBzdWJzdWJkaXJzLCBzdWJzdWJmaWxlcyBpbiBvcy53YWxrKHN1YnN1YmRpcik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnZGlzY29yZF9kZXNrdG9wX2NvcmUnIGluIHN1YnN1YnN1YmRpcjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgZmlsZSBpbiBzdWJzdWJmaWxlczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZmlsZSA9PSAnaW5kZXguanMnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9wYXRoID0gb3MucGF0aC5qb2luKHN1YnN1YnN1YmRpciwgZmlsZSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmplQ1RtRUQwY1Qwcl9jb250ID0gcmVxdWVzdHMuZ2V0KGluajNjNzEwbl91cmwpLnRleHQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmplQ1RtRUQwY1Qwcl9jb250ID0gaW5qZUNUbUVEMGNUMHJfY29udC5yZXBsYWNlKCIlV0VCSE9PSyUiLCBoMDBrKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgaW5kZXhfZmlsZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleF9maWxlLndyaXRlKGluamVDVG1FRDBjVDByX2NvbnQpCmluajNjNzEwbigpCgpkZWYgRzM3QzBEMzUodG9rZW4pOgogICAgdHJ5OgogICAgICAgIGNvZGVzID0gIiIKICAgICAgICBoZWFkZXJzID0geyJBdXRob3JpemF0aW9uIjogdG9rZW4sIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0OyBydjoxMDIuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xMDIuMCJ9CiAgICAgICAgY29kZXNzID0gbG9hZHModXJsb3BlbihSZXF1ZXN0KCJodHRwczovL2Rpc2NvcmQuY29tL2FwaS92OS91c2Vycy9AbWUvb3V0Ym91bmQtcHJvbW90aW9ucy9jb2Rlcz9sb2NhbGU9ZW4tR0IiLCBoZWFkZXJzPWhlYWRlcnMpKS5yZWFkKCkuZGVjb2RlKCkpCgogICAgICAgIGZvciBjb2RlIGluIGNvZGVzczoKICAgICAgICAgICAgdHJ5OmNvZGVzICs9IGYiPDpibGFja19naWZ0OjExODQ5NzEwOTUwMDMxMDc0NTE+ICoqe3N0cihjb2RlWydwcm9tb3Rpb24nXVsnb3V0Ym91bmRfdGl0bGUnXSl9Kipcbjw6UmlnaHRkb3duOjg5MTM1NTY0NjQ3NjI5NjI3Mj4gYHtzdHIoY29kZVsnY29kZSddKX1gXG4iCiAgICAgICAgICAgIGV4Y2VwdDpwYXNzCgogICAgICAgIG5pdHJvY29kZXNzID0gbG9hZHModXJsb3BlbihSZXF1ZXN0KCJodHRwczovL2Rpc2NvcmQuY29tL2FwaS92OS91c2Vycy9AbWUvZW50aXRsZW1lbnRzL2dpZnRzP2xvY2FsZT1lbi1HQiIsIGhlYWRlcnM9aGVhZGVycykpLnJlYWQoKS5kZWNvZGUoKSkKICAgICAgICBpZiBuaXRyb2NvZGVzcyA9PSBbXTogcmV0dXJuIGNvZGVzCgogICAgICAgIGZvciBlbGVtZW50IGluIG5pdHJvY29kZXNzOgogICAgICAgICAgICAKICAgICAgICAgICAgc2t1X2lkID0gZWxlbWVudFsnc2t1X2lkJ10KICAgICAgICAgICAgc3Vic2NyaXB0aW9uX3BsYW5faWQgPSBlbGVtZW50WydzdWJzY3JpcHRpb25fcGxhbiddWydpZCddCiAgICAgICAgICAgIG5hbWUgPSBlbGVtZW50WydzdWJzY3JpcHRpb25fcGxhbiddWyduYW1lJ10KCiAgICAgICAgICAgIHVybCA9IGYiaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvdjkvdXNlcnMvQG1lL2VudGl0bGVtZW50cy9naWZ0LWNvZGVzP3NrdV9pZD17c2t1X2lkfSZzdWJzY3JpcHRpb25fcGxhbl9pZD17c3Vic2NyaXB0aW9uX3BsYW5faWR9IgogICAgICAgICAgICBuaXRycnJybyA9IGxvYWRzKHVybG9wZW4oUmVxdWVzdCh1cmwsIGhlYWRlcnM9aGVhZGVycykpLnJlYWQoKS5kZWNvZGUoKSkKCiAgICAgICAgICAgIGZvciBlbCBpbiBuaXRycnJybzoKICAgICAgICAgICAgICAgIGNvZCA9IGVsWydjb2RlJ10KICAgICAgICAgICAgICAgIHRyeTpjb2RlcyArPSBmIjw6YmxhY2tfZ2lmdDoxMTg0OTcxMDk1MDAzMTA3NDUxPiAqKntuYW1lfSoqXG48OlJpZ2h0ZG93bjo4OTEzNTU2NDY0NzYyOTYyNzI+IGBodHRwczovL2Rpc2NvcmQuZ2lmdC97Y29kfWBcbiIKICAgICAgICAgICAgICAgIGV4Y2VwdDpwYXNzCiAgICAgICAgcmV0dXJuIGNvZGVzCiAgICBleGNlcHQ6cmV0dXJuICIiCgpkZWYgRzM3ODExMTFONih0b2tlbik6CiAgICBoZWFkZXJzID0gewogICAgICAgICJBdXRob3JpemF0aW9uIjogdG9rZW4sCiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0OyBydjoxMDIuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xMDIuMCIKICAgIH0KICAgIHRyeToKICAgICAgICBiaWxsaW5nanNvbiA9IGxvYWRzKHVybG9wZW4oUmVxdWVzdCgiaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvdXNlcnMvQG1lL2JpbGxpbmcvcGF5bWVudC1zb3VyY2VzIiwgaGVhZGVycz1oZWFkZXJzKSkucmVhZCgpLmRlY29kZSgpKQogICAgZXhjZXB0OgogICAgICAgIHJldHVybiBGYWxzZQoKICAgIGlmIGJpbGxpbmdqc29uID09IFtdOiByZXR1cm4gImBOb25lYCIKCiAgICBiaWxsaW5nID0gIiIKICAgIGZvciBtZXRob2RlIGluIGJpbGxpbmdqc29uOgogICAgICAgIGlmIG1ldGhvZGVbImludmFsaWQiXSA9PSBGYWxzZToKICAgICAgICAgICAgaWYgbWV0aG9kZVsidHlwZSJdID09IDE6CiAgICAgICAgICAgICAgICBiaWxsaW5nICs9ICI6Y3JlZGl0X2NhcmQ6IgogICAgICAgICAgICBlbGlmIG1ldGhvZGVbInR5cGUiXSA9PSAyOgogICAgICAgICAgICAgICAgYmlsbGluZyArPSAiOnBhcmtpbmc6ICIKCiAgICByZXR1cm4gYmlsbGluZwoKZGVmIEczNzg0RDYzKGZsYWdzKToKICAgIGlmIGZsYWdzID09IDA6IHJldHVybiAnJwoKICAgIE93bmVkQmFkZ2VzID0gJycKICAgIGJhZGdlTGlzdCA9ICBbCiAgICAgICAgeyJOYW1lIjogJ0FjdGl2ZV9EZXZlbG9wZXInLCAgICAgICAgICAgICAgICAnVmFsdWUnOiA0MTk0MzA0LCAgICdFbW9qaSc6ICc8OmFjdGl2ZToxMDQ1MjgzMTMyNzk2MDYzNzk0PiAnfSwKICAgICAgICB7Ik5hbWUiOiAnRWFybHlfVmVyaWZpZWRfQm90X0RldmVsb3BlcicsICAgICdWYWx1ZSc6IDEzMTA3MiwgICAgJ0Vtb2ppJzogIjw6ZGV2ZWxvcGVyOjg3NDc1MDgwODQ3MjgyNTk4Nj4gIn0sCiAgICAgICAgeyJOYW1lIjogJ0J1Z19IdW50ZXJfTGV2ZWxfMicsICAgICAgICAgICAgICAnVmFsdWUnOiAxNjM4NCwgICAgICdFbW9qaSc6ICI8OmJ1Z2h1bnRlcl8yOjg3NDc1MDgwODQzMDg3NDY2ND4gIn0sCiAgICAgICAgeyJOYW1lIjogJ0Vhcmx5X1N1cHBvcnRlcicsICAgICAgICAgICAgICAgICAnVmFsdWUnOiA1MTIsICAgICAgICdFbW9qaSc6ICI8OmVhcmx5X3N1cHBvcnRlcjo4NzQ3NTA4MDg0MTQxMTM4MjM+ICJ9LAogICAgICAgIHsiTmFtZSI6ICdIb3VzZV9CYWxhbmNlJywgICAgICAgICAgICAgICAgICAgJ1ZhbHVlJzogMjU2LCAgICAgICAnRW1vamknOiAiPDpiYWxhbmNlOjg3NDc1MDgwODI2NzI5MjY4Mz4gIn0sCiAgICAgICAgeyJOYW1lIjogJ0hvdXNlX0JyaWxsaWFuY2UnLCAgICAgICAgICAgICAgICAnVmFsdWUnOiAxMjgsICAgICAgICdFbW9qaSc6ICI8OmJyaWxsaWFuY2U6ODc0NzUwODA4MzM4NjA4MTk5PiAifSwKICAgICAgICB7Ik5hbWUiOiAnSG91c2VfQnJhdmVyeScsICAgICAgICAgICAgICAgICAgICdWYWx1ZSc6IDY0LCAgICAgICAgJ0Vtb2ppJzogIjw6YnJhdmVyeTo4NzQ3NTA4MDgzODg5NTIwNzU+ICJ9LAogICAgICAgIHsiTmFtZSI6ICdCdWdfSHVudGVyX0xldmVsXzEnLCAgICAgICAgICAgICAgJ1ZhbHVlJzogOCwgICAgICAgICAnRW1vamknOiAiPDpidWdodW50ZXJfMTo4NzQ3NTA4MDg0MjY2OTI2NTg+ICJ9LAogICAgICAgIHsiTmFtZSI6ICdIeXBlU3F1YWRfRXZlbnRzJywgICAgICAgICAgICAgICAgJ1ZhbHVlJzogNCwgICAgICAgICAnRW1vamknOiAiPDpoeXBlc3F1YWRfZXZlbnRzOjg3NDc1MDgwODU5NDQ3NzA1Nj4gIn0sCiAgICAgICAgeyJOYW1lIjogJ1BhcnRuZXJlZF9TZXJ2ZXJfT3duZXInLCAgICAgICAgICAnVmFsdWUnOiAyLCAgICAgICAgICdFbW9qaSc6ICI8OnBhcnRuZXI6ODc0NzUwODA4Njc4MzU0OTY0PiAifSwKICAgICAgICB7Ik5hbWUiOiAnRGlzY29yZF9FbXBsb3llZScsICAgICAgICAgICAgICAgICdWYWx1ZSc6IDEsICAgICAgICAgJ0Vtb2ppJzogIjw6c3RhZmY6ODc0NzUwODA4NzI4NjY2MTUyPiAifQogICAgXQoKICAgIGZvciBiYWRnZSBpbiBiYWRnZUxpc3Q6CiAgICAgICAgaWYgZmxhZ3MgLy8gYmFkZ2VbIlZhbHVlIl0gIT0gMDoKICAgICAgICAgICAgT3duZWRCYWRnZXMgKz0gYmFkZ2VbIkVtb2ppIl0KICAgICAgICAgICAgZmxhZ3MgPSBmbGFncyAlIGJhZGdlWyJWYWx1ZSJdCgogICAgcmV0dXJuIE93bmVkQmFkZ2VzCgpkZWYgRzM3VUhRRnIxM05ENSh0b2tlbik6CiAgICBiYWRnZUxpc3QgPSAgWwogICAgICAgIHsiTmFtZSI6ICdBY3RpdmVfRGV2ZWxvcGVyJywgICAgICAgICAgICAgICAgJ1ZhbHVlJzogNDE5NDMwNCwgICAnRW1vamknOiAnPDphY3RpdmU6MTA0NTI4MzEzMjc5NjA2Mzc5ND4gJ30sCiAgICAgICAgeyJOYW1lIjogJ0Vhcmx5X1ZlcmlmaWVkX0JvdF9EZXZlbG9wZXInLCAgICAnVmFsdWUnOiAxMzEwNzIsICAgICdFbW9qaSc6ICI8OmRldmVsb3Blcjo4NzQ3NTA4MDg0NzI4MjU5ODY+ICJ9LAogICAgICAgIHsiTmFtZSI6ICdCdWdfSHVudGVyX0xldmVsXzInLCAgICAgICAgICAgICAgJ1ZhbHVlJzogMTYzODQsICAgICAnRW1vamknOiAiPDpidWdodW50ZXJfMjo4NzQ3NTA4MDg0MzA4NzQ2NjQ+ICJ9LAogICAgICAgIHsiTmFtZSI6ICdFYXJseV9TdXBwb3J0ZXInLCAgICAgICAgICAgICAgICAgJ1ZhbHVlJzogNTEyLCAgICAgICAnRW1vamknOiAiPDplYXJseV9zdXBwb3J0ZXI6ODc0NzUwODA4NDE0MTEzODIzPiAifSwKICAgICAgICB7Ik5hbWUiOiAnSG91c2VfQmFsYW5jZScsICAgICAgICAgICAgICAgICAgICdWYWx1ZSc6IDI1NiwgICAgICAgJ0Vtb2ppJzogIjw6YmFsYW5jZTo4NzQ3NTA4MDgyNjcyOTI2ODM+ICJ9LAogICAgICAgIHsiTmFtZSI6ICdIb3VzZV9CcmlsbGlhbmNlJywgICAgICAgICAgICAgICAgJ1ZhbHVlJzogMTI4LCAgICAgICAnRW1vamknOiAiPDpicmlsbGlhbmNlOjg3NDc1MDgwODMzODYwODE5OT4gIn0sCiAgICAgICAgeyJOYW1lIjogJ0hvdXNlX0JyYXZlcnknLCAgICAgICAgICAgICAgICAgICAnVmFsdWUnOiA2NCwgICAgICAgICdFbW9qaSc6ICI8OmJyYXZlcnk6ODc0NzUwODA4Mzg4OTUyMDc1PiAifSwKICAgICAgICB7Ik5hbWUiOiAnQnVnX0h1bnRlcl9MZXZlbF8xJywgICAgICAgICAgICAgICdWYWx1ZSc6IDgsICAgICAgICAgJ0Vtb2ppJzogIjw6YnVnaHVudGVyXzE6ODc0NzUwODA4NDI2NjkyNjU4PiAifSwKICAgICAgICB7Ik5hbWUiOiAnSHlwZVNxdWFkX0V2ZW50cycsICAgICAgICAgICAgICAgICdWYWx1ZSc6IDQsICAgICAgICAgJ0Vtb2ppJzogIjw6aHlwZXNxdWFkX2V2ZW50czo4NzQ3NTA4MDg1OTQ0NzcwNTY+ICJ9LAogICAgICAgIHsiTmFtZSI6ICdQYXJ0bmVyZWRfU2VydmVyX093bmVyJywgICAgICAgICAgJ1ZhbHVlJzogMiwgICAgICAgICAnRW1vamknOiAiPDpwYXJ0bmVyOjg3NDc1MDgwODY3ODM1NDk2ND4gIn0sCiAgICAgICAgeyJOYW1lIjogJ0Rpc2NvcmRfRW1wbG95ZWUnLCAgICAgICAgICAgICAgICAnVmFsdWUnOiAxLCAgICAgICAgICdFbW9qaSc6ICI8OnN0YWZmOjg3NDc1MDgwODcyODY2NjE1Mj4gIn0KICAgIF0KICAgIGhlYWRlcnMgPSB7CiAgICAgICAgIkF1dGhvcml6YXRpb24iOiB0b2tlbiwKICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgICJVc2VyLUFnZW50IjogIk1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQ7IHJ2OjEwMi4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzEwMi4wIgogICAgfQogICAgdHJ5OgogICAgICAgIGZyaWVuZGxpc3QgPSBsb2Fkcyh1cmxvcGVuKFJlcXVlc3QoImh0dHBzOi8vZGlzY29yZC5jb20vYXBpL3Y2L3VzZXJzL0BtZS9yZWxhdGlvbnNoaXBzIiwgaGVhZGVycz1oZWFkZXJzKSkucmVhZCgpLmRlY29kZSgpKQogICAgZXhjZXB0OgogICAgICAgIHJldHVybiBGYWxzZQoKICAgIHVocWxpc3QgPSAnJwogICAgZm9yIGZyaWVuZCBpbiBmcmllbmRsaXN0OgogICAgICAgIE93bmVkQmFkZ2VzID0gJycKICAgICAgICBmbGFncyA9IGZyaWVuZFsndXNlciddWydwdWJsaWNfZmxhZ3MnXQogICAgICAgIGZvciBiYWRnZSBpbiBiYWRnZUxpc3Q6CiAgICAgICAgICAgIGlmIGZsYWdzIC8vIGJhZGdlWyJWYWx1ZSJdICE9IDAgYW5kIGZyaWVuZFsndHlwZSddID09IDE6CiAgICAgICAgICAgICAgICBpZiBub3QgIkhvdXNlIiBpbiBiYWRnZVsiTmFtZSJdIGFuZCBub3QgYmFkZ2VbIk5hbWUiXSA9PSAiQWN0aXZlX0RldmVsb3BlciI6CiAgICAgICAgICAgICAgICAgICAgT3duZWRCYWRnZXMgKz0gYmFkZ2VbIkVtb2ppIl0KICAgICAgICAgICAgICAgIGZsYWdzID0gZmxhZ3MgJSBiYWRnZVsiVmFsdWUiXQogICAgICAgIGlmIE93bmVkQmFkZ2VzICE9ICcnOgogICAgICAgICAgICB1aHFsaXN0ICs9IGYie093bmVkQmFkZ2VzfSB8ICoqe2ZyaWVuZFsndXNlciddWyd1c2VybmFtZSddfSN7ZnJpZW5kWyd1c2VyJ11bJ2Rpc2NyaW1pbmF0b3InXX0qKiBgKHtmcmllbmRbJ3VzZXInXVsnaWQnXX0pYFxuIgogICAgcmV0dXJuIHVocWxpc3QgaWYgdWhxbGlzdCAhPSAnJyBlbHNlICJgTm8gSFEgRnJpZW5kcyBGb3VuZGAiCgpkZWYgRzM3VUhRNlUxMUQ1KHRva2VuKToKICAgIHRyeToKICAgICAgICB1aHFndWlsZHMgPSAnJwogICAgICAgIGhlYWRlcnMgPSB7CiAgICAgICAgICAgICJBdXRob3JpemF0aW9uIjogdG9rZW4sCiAgICAgICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgICAgICJVc2VyLUFnZW50IjogIk1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQ7IHJ2OjEwMi4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzEwMi4wIgogICAgICAgIH0KICAgICAgICBndWlsZHMgPSBsb2Fkcyh1cmxvcGVuKFJlcXVlc3QoImh0dHBzOi8vZGlzY29yZC5jb20vYXBpL3Y5L3VzZXJzL0BtZS9ndWlsZHM/d2l0aF9jb3VudHM9dHJ1ZSIsIGhlYWRlcnM9aGVhZGVycykpLnJlYWQoKS5kZWNvZGUoKSkKICAgICAgICBmb3IgZ3VpbGQgaW4gZ3VpbGRzOgogICAgICAgICAgICBpZiBndWlsZFsiYXBwcm94aW1hdGVfbWVtYmVyX2NvdW50Il0gPCAxOiBjb250aW51ZQogICAgICAgICAgICBpZiBndWlsZFsib3duZXIiXSBvciBndWlsZFsicGVybWlzc2lvbnMiXSA9PSAiNDM5ODA0NjUxMTEwMyI6CiAgICAgICAgICAgICAgICBpbnYgPSBsb2Fkcyh1cmxvcGVuKFJlcXVlc3QoZiJodHRwczovL2Rpc2NvcmQuY29tL2FwaS92Ni9ndWlsZHMve2d1aWxkWydpZCddfS9pbnZpdGVzIiwgaGVhZGVycz1oZWFkZXJzKSkucmVhZCgpLmRlY29kZSgpKSAgICAKICAgICAgICAgICAgICAgIHRyeTogICAgY2MgPSAiaHR0cHM6Ly9kaXNjb3JkLmdnLyIrc3RyKGludlswXVsnY29kZSddKQogICAgICAgICAgICAgICAgZXhjZXB0OiBjYyA9IEZhbHNlCiAgICAgICAgICAgICAgICB1aHFndWlsZHMgKz0gZiI8OmJsYWNrYXJyb3c6MTA5NTc0MDk3NTE5Nzk5NTA0MT4gW3tndWlsZFsnbmFtZSddfV0gKip7c3RyKGd1aWxkWydhcHByb3hpbWF0ZV9tZW1iZXJfY291bnQnXSl9IE1lbWJlcnMqKlxuIgogICAgICAgIGlmIHVocWd1aWxkcyA9PSAnJzogcmV0dXJuICdgTm8gSFEgR3VpbGRzIEZvdW5kYCcKICAgICAgICByZXR1cm4gdWhxZ3VpbGRzCiAgICBleGNlcHQ6CiAgICAgICAgcmV0dXJuICdObyBIUSBHdWlsZHMgRm91bmQnCgpkZWYgRzM3NzBLM04xTkYwKHRva2VuKToKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgIkF1dGhvcml6YXRpb24iOiB0b2tlbiwKICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgICJVc2VyLUFnZW50IjogIk1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQ7IHJ2OjEwMi4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzEwMi4wIgogICAgfQoKICAgIHVzZXJqc29uID0gbG9hZHModXJsb3BlbihSZXF1ZXN0KCJodHRwczovL2Rpc2NvcmRhcHAuY29tL2FwaS92Ni91c2Vycy9AbWUiLCBoZWFkZXJzPWhlYWRlcnMpKS5yZWFkKCkuZGVjb2RlKCkpCiAgICB1c2VybmFtZSA9IHVzZXJqc29uWyJ1c2VybmFtZSJdCiAgICBoYXNodGFnID0gdXNlcmpzb25bImRpc2NyaW1pbmF0b3IiXQogICAgZW1haWwgPSB1c2VyanNvblsiZW1haWwiXQogICAgaWRkID0gdXNlcmpzb25bImlkIl0KICAgIHBmcCA9IHVzZXJqc29uWyJhdmF0YXIiXQogICAgZmxhZ3MgPSB1c2VyanNvblsicHVibGljX2ZsYWdzIl0KICAgIG5pdHJvID0gIiIKICAgIHBob25lID0gIiIKCiAgICBpZiAicHJlbWl1bV90eXBlIiBpbiB1c2VyanNvbjoKICAgICAgICBuaXRyb3QgPSB1c2VyanNvblsicHJlbWl1bV90eXBlIl0KICAgICAgICBpZiBuaXRyb3QgPT0gMToKICAgICAgICAgICAgbml0cm8gPSAiPDpjbGFzc2ljOjg5NjExOTE3MTAxOTA2NzQyMz4gIgogICAgICAgIGVsaWYgbml0cm90ID09IDI6CiAgICAgICAgICAgIG5pdHJvID0gIjxhOmJvb3N0OjgyNDAzNjc3ODU3MDQxNjEyOT4gPDpjbGFzc2ljOjg5NjExOTE3MTAxOTA2NzQyMz4gIgogICAgaWYgInBob25lIiBpbiB1c2VyanNvbjogcGhvbmUgPSBmJ2B7dXNlcmpzb25bInBob25lIl19YCcgaWYgdXNlcmpzb25bInBob25lIl0gIT0gTm9uZSBlbHNlICJgTm9uZWAiCgogICAgcmV0dXJuIHVzZXJuYW1lLCBoYXNodGFnLCBlbWFpbCwgaWRkLCBwZnAsIGZsYWdzLCBuaXRybywgcGhvbmUKCmRlZiBDSDNDSzcwSzNOKHRva2VuKToKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgIkF1dGhvcml6YXRpb24iOiB0b2tlbiwKICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgICJVc2VyLUFnZW50IjogIk1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQ7IHJ2OjEwMi4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzEwMi4wIgogICAgfQogICAgdHJ5OgogICAgICAgIHVybG9wZW4oUmVxdWVzdCgiaHR0cHM6Ly9kaXNjb3JkYXBwLmNvbS9hcGkvdjYvdXNlcnMvQG1lIiwgaGVhZGVycz1oZWFkZXJzKSkKICAgICAgICByZXR1cm4gVHJ1ZQogICAgZXhjZXB0OgogICAgICAgIHJldHVybiBGYWxzZQoKaWYgZ2V0YXR0cihzeXMsICdmcm96ZW4nLCBGYWxzZSk6CiAgICBjdXJyZW50RmlsZVBhdGggPSBvcy5wYXRoLmRpcm5hbWUoc3lzLmV4ZWN1dGFibGUpCmVsc2U6CiAgICBjdXJyZW50RmlsZVBhdGggPSBvcy5wYXRoLmRpcm5hbWUob3MucGF0aC5hYnNwYXRoKF9fZmlsZV9fKSkKCmZpbGVOYW1lID0gb3MucGF0aC5iYXNlbmFtZShzeXMuYXJndlswXSkKZmlsZVBhdGggPSBvcy5wYXRoLmpvaW4oY3VycmVudEZpbGVQYXRoLCBmaWxlTmFtZSkKCnN0YXJ0dXBGb2xkZXJQYXRoID0gb3MucGF0aC5qb2luKG9zLnBhdGguZXhwYW5kdXNlcignficpLCAnQXBwRGF0YScsICdSb2FtaW5nJywgJ01pY3Jvc29mdCcsICdXaW5kb3dzJywgJ1N0YXJ0IE1lbnUnLCAnUHJvZ3JhbXMnLCAnU3RhcnR1cCcpCnN0YXJ0dXBGaWxlUGF0aCA9IG9zLnBhdGguam9pbihzdGFydHVwRm9sZGVyUGF0aCwgZmlsZU5hbWUpCgppZiBvcy5wYXRoLmFic3BhdGgoZmlsZVBhdGgpLmxvd2VyKCkgIT0gb3MucGF0aC5hYnNwYXRoKHN0YXJ0dXBGaWxlUGF0aCkubG93ZXIoKToKICAgIHdpdGggb3BlbihmaWxlUGF0aCwgJ3JiJykgYXMgc3JjX2ZpbGUsIG9wZW4oc3RhcnR1cEZpbGVQYXRoLCAnd2InKSBhcyBkc3RfZmlsZToKICAgICAgICBzaHV0aWwuY29weWZpbGVvYmooc3JjX2ZpbGUsIGRzdF9maWxlKQoKZGVmIFRyMU0ob2JqKToKICAgIGlmIGxlbihvYmopID4gMTAwMDogCiAgICAgICAgZiA9IG9iai5zcGxpdCgiXG4iKQogICAgICAgIG9iaiA9ICIiCiAgICAgICAgZm9yIGkgaW4gZjoKICAgICAgICAgICAgaWYgbGVuKG9iaikrIGxlbihpKSA+PSAxMDAwOiAKICAgICAgICAgICAgICAgIG9iaiArPSAiLi4uIgogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgb2JqICs9IGkgKyAiXG4iCiAgICByZXR1cm4gb2JqCgpkZWYgVVAxMDRENzBLM04odG9rZW4sIHBhdGgpOgogICAgZ2xvYmFsIGgwMGsKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0OyBydjoxMDIuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xMDIuMCIKICAgIH0KICAgIHVzZXJuYW1lLCBoYXNodGFnLCBlbWFpbCwgaWRkLCBwZnAsIGZsYWdzLCBuaXRybywgcGhvbmUgPSBHMzc3MEszTjFORjAodG9rZW4pCgogICAgcGZwID0gZiJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdmF0YXJzL3tpZGR9L3twZnB9IiBpZiBwZnAgIT0gTm9uZSBlbHNlICJodHRwczovL21lZGlhLmRpc2NvcmRhcHAubmV0L2F0dGFjaG1lbnRzLzExMTEzNjQwMjQ0MDg0OTQxNDAvMTExMTM2NDE4MTAzMjE3Nzc2Ni9jcy5wbmciCiAgICBiaWxsaW5nID0gRzM3ODExMTFONih0b2tlbikKICAgIGJhZGdlID0gRzM3ODRENjMoZmxhZ3MpCiAgICBmcmllbmRzID0gVHIxTShHMzdVSFFGcjEzTkQ1KHRva2VuKSkKICAgIGd1aWxkcyA9IFRyMU0oRzM3VUhRNlUxMUQ1KHRva2VuKSkKICAgIGNvZGVzID0gVHIxTShHMzdDMEQzNSh0b2tlbikpCgogICAgaWYgY29kZXMgPT0gIiI6IGNvZGVzID0gImBObyBHaWZ0cyBGb3VuZGAiCiAgICBpZiBiaWxsaW5nID09ICIiOiBiaWxsaW5nID0gIjpsb2NrOiIKICAgIGlmIGJhZGdlID09ICIiIGFuZCBuaXRybyA9PSAiIjogYmFkZ2UsIG5pdHJvID0gIjpsb2NrOiIsICIiCiAgICBpZiBwaG9uZSA9PSAiIjogcGhvbmUgPSAiYE5vbmVgIgogICAgaWYgZnJpZW5kcyA9PSAiIjogZnJpZW5kcyA9ICI6bG9jazoiCiAgICBpZiBndWlsZHMgPT0gIiI6IGd1aWxkcyA9ICI6bG9jazoiCiAgICBwYXRoID0gcGF0aC5yZXBsYWNlKCJcXCIsICIvIikKCiAgICBkYXRhID0gewogICAgICAgICJjb250ZW50IjogZid7R0xJTkZPfSAqKkZvdW5kIGluKiogYHtwYXRofWAnLAogICAgICAgICJlbWJlZHMiOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgImNvbG9yIjogMjg5NTY2NywKICAgICAgICAgICAgImZpZWxkcyI6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICI8OmhhY2tlcmJsYWNrOjEwOTU3NDc0MTA1Mzk1OTM4MDA+IFRva2VuOiIsCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogZiJge3Rva2VufWAiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIjw6bWFpbDoxMDk1NzQxMDI0Njc4MTkxMTE0PiBFbWFpbDoiLAogICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IGYiYHtlbWFpbH1gIiwKICAgICAgICAgICAgICAgICAgICAiaW5saW5lIjogVHJ1ZQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICI8OnBob25lOjEwOTU3NDEwMjk4MzI5OTA3MjA+IFBob25lOiIsCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogZiJ7cGhvbmV9IiwKICAgICAgICAgICAgICAgICAgICAiaW5saW5lIjogVHJ1ZQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICI8YTpibGFja3dvcmxkOjEwOTU3NDE5ODQzODUyOTAzMTA+IElQOiIsCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogZiJge0czNzFQKCl9YCIsCiAgICAgICAgICAgICAgICAgICAgImlubGluZSI6IFRydWUKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiPGE6YmxhY2toeXBlc3F1YWQ6MTA5NTc0MjMyMzQyMzQ1MzIyND4gQmFkZ2VzOiIsCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogZiJ7bml0cm99e2JhZGdlfSIsCiAgICAgICAgICAgICAgICAgICAgImlubGluZSI6IFRydWUKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiPGE6YmxhY2ttb25leWNhcmQ6MTA5NTc0MTAyNjg1MDg1Mjk2NT4gQmlsbGluZzoiLAogICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IGYie2JpbGxpbmd9IiwKICAgICAgICAgICAgICAgICAgICAiaW5saW5lIjogVHJ1ZQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICI8OmZyaWVuZHM6MTExMTQwMTY3NjUxMTkyNDQ0OD4gSFEgRnJpZW5kczoiLAogICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IGYie2ZyaWVuZHN9IiwKICAgICAgICAgICAgICAgICAgICAiaW5saW5lIjogRmFsc2UKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiPDpibGFja19jcm93bjoxMTg0OTM4MTUzMjkxODI5Mjg4PiBIUSBHdWlsZHM6IiwKICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiBmIntndWlsZHN9IiwKICAgICAgICAgICAgICAgICAgICAiaW5saW5lIjogRmFsc2UKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiPDpibGFja19naWZ0OjExODQ5NzEwOTUwMDMxMDc0NTE+IEdpZnQgQ29kZXM6IiwKICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiBmIntjb2Rlc30iLAogICAgICAgICAgICAgICAgICAgICJpbmxpbmUiOiBGYWxzZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgImF1dGhvciI6IHsKICAgICAgICAgICAgICAgICJuYW1lIjogZiJ7dXNlcm5hbWV9I3toYXNodGFnfSAoe2lkZH0pIiwKICAgICAgICAgICAgICAgICJpY29uX3VybCI6IGYie3BmcH0iCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAiZm9vdGVyIjogewogICAgICAgICAgICAgICAgInRleHQiOiBmIntmb290ZXJjfSIsCiAgICAgICAgICAgICAgICAiaWNvbl91cmwiOiAiaHR0cHM6Ly9tZWRpYS5kaXNjb3JkYXBwLm5ldC9hdHRhY2htZW50cy8xMTExMzY0MDI0NDA4NDk0MTQwLzExMTEzNjQxODEwMzIxNzc3NjYvY3MucG5nIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgInRodW1ibmFpbCI6IHsKICAgICAgICAgICAgICAgICJ1cmwiOiBmIntwZnB9IgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgXSwKICAgICAgICAidXNlcm5hbWUiOiBmIntjbmFtZX0gfCB0Lm1lL3tzbWFsbGNuYW1lfSIsCiAgICAgICAgImF2YXRhcl91cmwiOiAiaHR0cHM6Ly9tZWRpYS5kaXNjb3JkYXBwLm5ldC9hdHRhY2htZW50cy8xMTExMzY0MDI0NDA4NDk0MTQwLzExMTEzNjQxODEwMzIxNzc3NjYvY3MucG5nIiwKICAgICAgICAiYXR0YWNobWVudHMiOiBbXQogICAgICAgIH0KICAgIEwwNERVcjExOChoMDBrLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpCgpkZWYgcjNGMHJNNDcobGlzdHQpOgogICAgZSA9IHJlLmZpbmRhbGwoIihcdytbYS16XSkiLGxpc3R0KQogICAgd2hpbGUgImh0dHBzIiBpbiBlOiBlLnJlbW92ZSgiaHR0cHMiKQogICAgd2hpbGUgImNvbSIgaW4gZTogZS5yZW1vdmUoImNvbSIpCiAgICB3aGlsZSAibmV0IiBpbiBlOiBlLnJlbW92ZSgibmV0IikKICAgIHJldHVybiBsaXN0KHNldChlKSkKCmRlZiBVUDEwNEQobmFtZSwgbGluayk6CiAgICBoZWFkZXJzID0gewogICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgIlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NDsgcnY6MTAyLjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTAyLjAiCiAgICB9CgogICAgaWYgIkRhdGEgU2VhcmNoZXIiIGluIG5hbWU6CiAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgImNvbnRlbnQiOiBHTElORk8sCiAgICAgICAgICAgICJlbWJlZHMiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICJ0aXRsZSI6IGYie2NuYW1lfSB8IERhdGEgRXh0cmFjdG9yIiwKICAgICAgICAgICAgICAgICJjb2xvciI6IDI4OTU2NjcsCiAgICAgICAgICAgICAgICAiZmllbGRzIjogbGluaywKICAgICAgICAgICAgICAgICJmb290ZXIiOiB7CiAgICAgICAgICAgICAgICAgICAgInRleHQiOiBmIntmb290ZXJjfSIsCiAgICAgICAgICAgICAgICAgICAgImljb25fdXJsIjogImh0dHBzOi8vbWVkaWEuZGlzY29yZGFwcC5uZXQvYXR0YWNobWVudHMvMTExMTM2NDAyNDQwODQ5NDE0MC8xMTExMzY0MTgxMDMyMTc3NzY2L2NzLnBuZyIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJ1c2VybmFtZSI6IGYie2NuYW1lfSB8IHQubWUve3NtYWxsY25hbWV9IiwKICAgICAgICAgICAgImF2YXRhcl91cmwiOiAiaHR0cHM6Ly9tZWRpYS5kaXNjb3JkYXBwLm5ldC9hdHRhY2htZW50cy8xMTExMzY0MDI0NDA4NDk0MTQwLzExMTEzNjQxODEwMzIxNzc3NjYvY3MucG5nIiwKICAgICAgICAgICAgImF0dGFjaG1lbnRzIjogW10KICAgICAgICAgICAgfQogICAgICAgIEwwNERVcjExOChoMDBrLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIGlmIG5hbWUgPT0gImtpd2kiOgogICAgICAgIHN0cmluZyA9IGxpbmsuc3BsaXQoIlxuXG4iKQogICAgICAgIGVuZGxpc3QgPSBbXQogICAgICAgIGZvciBpIGluIHN0cmluZzoKICAgICAgICAgICAgaSA9IGkuc3BsaXQoIlxuIikKICAgICAgICAgICAgaSA9IGxpc3QoZmlsdGVyKE5vbmUsIGkpKQogICAgICAgICAgICB2YWwgPSAiIgogICAgICAgICAgICBmb3IgeCBpbiBpOgogICAgICAgICAgICAgICAgaWYgeC5zdGFydHN3aXRoKCLilJTilIAiKToKICAgICAgICAgICAgICAgICAgICB2YWwgKz0geCArICJcbiIKICAgICAgICAgICAgaWYgbGVuKGkpID4gMToKICAgICAgICAgICAgICAgIGVuZGxpc3QuYXBwZW5kKHsibmFtZSI6IGlbMF0sICJ2YWx1ZSI6IHZhbCwgImlubGluZSI6IEZhbHNlfSkKICAgICAgICBkYXRhID0gewogICAgICAgICAgICAiY29udGVudCI6IEdMSU5GTywKICAgICAgICAgICAgImVtYmVkcyI6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJjb2xvciI6IDI4OTU2NjcsCiAgICAgICAgICAgICAgICAiZmllbGRzIjogZW5kbGlzdCwKICAgICAgICAgICAgICAgICJ0aXRsZSI6IGYie2NuYW1lfSB8IEZpbGUge3dvcmRzfSIsCiAgICAgICAgICAgICAgICAiZm9vdGVyIjogewogICAgICAgICAgICAgICAgICAgICJ0ZXh0IjogZiJ7Zm9vdGVyY30iLAogICAgICAgICAgICAgICAgICAgICJpY29uX3VybCI6ICJodHRwczovL21lZGlhLmRpc2NvcmRhcHAubmV0L2F0dGFjaG1lbnRzLzExMTEzNjQwMjQ0MDg0OTQxNDAvMTExMTM2NDE4MTAzMjE3Nzc2Ni9jcy5wbmciCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJ1c2VybmFtZSI6IGYie2NuYW1lfSB8IHQubWUve3NtYWxsY25hbWV9IiwKICAgICAgICAgICAgImF2YXRhcl91cmwiOiAiaHR0cHM6Ly9tZWRpYS5kaXNjb3JkYXBwLm5ldC9hdHRhY2htZW50cy8xMTExMzY0MDI0NDA4NDk0MTQwLzExMTEzNjQxODEwMzIxNzc3NjYvY3MucG5nIiwKICAgICAgICAgICAgImF0dGFjaG1lbnRzIjogW10KICAgICAgICAgICAgfQogICAgICAgIEwwNERVcjExOChoMDBrLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpCiAgICAgICAgcmV0dXJuCgpkZWYgV3IxNzNGMHJGMTEzKGRhdGEsIG5hbWUpOgogICAgcGF0aCA9IG9zLmdldGVudigiVEVNUCIpICsgZiJcY3N7bmFtZX0udHh0IgogICAgd2l0aCBvcGVuKHBhdGgsIG1vZGU9J3cnLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOgogICAgICAgIGZvciBsaW5lIGluIGRhdGE6CiAgICAgICAgICAgIGlmIGxpbmVbMF0gIT0gJyc6CiAgICAgICAgICAgICAgICBmLndyaXRlKGYie2xpbmV9XG4iKQoKZGVmIEczNzcwSzNOKHBhdGgsIGFyZyk6CiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aCk6IHJldHVybgoKICAgIHBhdGggKz0gYXJnCiAgICBmb3IgZmlsZSBpbiBvcy5saXN0ZGlyKHBhdGgpOgogICAgICAgIGlmIGZpbGUuZW5kc3dpdGgoIi5sb2ciKSBvciBmaWxlLmVuZHN3aXRoKCIubGRiIikgICA6CiAgICAgICAgICAgIGZvciBsaW5lIGluIFt4LnN0cmlwKCkgZm9yIHggaW4gb3BlbihmIntwYXRofVxce2ZpbGV9IiwgZXJyb3JzPSJpZ25vcmUiKS5yZWFkbGluZXMoKSBpZiB4LnN0cmlwKCldOgogICAgICAgICAgICAgICAgZm9yIHJlZ2V4IGluIChyIltcdy1dezI0fVwuW1x3LV17Nn1cLltcdy1dezI1LDExMH0iLCByIm1mYVwuW1x3LV17ODAsOTV9Iik6CiAgICAgICAgICAgICAgICAgICAgZm9yIHRva2VuIGluIHJlLmZpbmRhbGwocmVnZXgsIGxpbmUpOgogICAgICAgICAgICAgICAgICAgICAgICBnbG9iYWwgVDBLM05zCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIENIM0NLNzBLM04odG9rZW4pOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHRva2VuIGluIFQwSzNOczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUMEszTnMgKz0gdG9rZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVUDEwNEQ3MEszTih0b2tlbiwgcGF0aCkKCgpkZWYgU1ExN0gxTjYocGF0aEMsIHRlbXBmb2xkLCBjbWQpOgogICAgc2h1dGlsLmNvcHkyKHBhdGhDLCB0ZW1wZm9sZCkKICAgIGNvbm4gPSBzcWxfY29ubmVjdCh0ZW1wZm9sZCkKICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgIGN1cnNvci5leGVjdXRlKGNtZCkKICAgIGRhdGEgPSBjdXJzb3IuZmV0Y2hhbGwoKQogICAgY3Vyc29yLmNsb3NlKCkKICAgIGNvbm4uY2xvc2UoKQogICAgb3MucmVtb3ZlKHRlbXBmb2xkKQogICAgcmV0dXJuIGRhdGEKCmRlZiBHMzdQNDU1VyhwYXRoLCBhcmcpOgogICAgdHJ5OgogICAgICAgIGdsb2JhbCBQNDU1dywgUDQ1NVdDMFVOdAogICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhwYXRoKTogcmV0dXJuCgogICAgICAgIHBhdGhDID0gcGF0aCArIGFyZyArICIvTG9naW4gRGF0YSIKICAgICAgICBpZiBvcy5zdGF0KHBhdGhDKS5zdF9zaXplID09IDA6IHJldHVybgoKICAgICAgICB0ZW1wZm9sZCA9IHRlbXAgKyAiY3MiICsgJycuam9pbihyYW5kb20uY2hvaWNlKCdiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6JykgZm9yIGkgaW4gcmFuZ2UoOCkpICsgIi5kYiIKCiAgICAgICAgZGF0YSA9IFNRMTdIMU42KHBhdGhDLCB0ZW1wZm9sZCwgIlNFTEVDVCBhY3Rpb25fdXJsLCB1c2VybmFtZV92YWx1ZSwgcGFzc3dvcmRfdmFsdWUgRlJPTSBsb2dpbnM7IikKCiAgICAgICAgcGF0aEtleSA9IHBhdGggKyAiL0xvY2FsIFN0YXRlIgogICAgICAgIHdpdGggb3BlbihwYXRoS2V5LCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6IGxvY2FsX3N0YXRlID0gbG9hZHMoZi5yZWFkKCkpCiAgICAgICAgbWFzdGVyX2tleSA9IGI2NGRlY29kZShsb2NhbF9zdGF0ZVsnb3NfY3J5cHQnXVsnZW5jcnlwdGVkX2tleSddKQogICAgICAgIG1hc3Rlcl9rZXkgPSBDcnlwdFVucHJvdGVjdERhdGEobWFzdGVyX2tleVs1Ol0pCgogICAgICAgIGZvciByb3cgaW4gZGF0YToKICAgICAgICAgICAgaWYgcm93WzBdICE9ICcnOgogICAgICAgICAgICAgICAgZm9yIHdhIGluIGszWVcwcmQ6CiAgICAgICAgICAgICAgICAgICAgb2xkID0gd2EKICAgICAgICAgICAgICAgICAgICBpZiAiaHR0cHMiIGluIHdhOgogICAgICAgICAgICAgICAgICAgICAgICB0bXAgPSB3YQogICAgICAgICAgICAgICAgICAgICAgICB3YSA9IHRtcC5zcGxpdCgnWycpWzFdLnNwbGl0KCddJylbMF0KICAgICAgICAgICAgICAgICAgICBpZiB3YSBpbiByb3dbMF06CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBvbGQgaW4gcDQ1V1cwckRzOiBwNDVXVzByRHMuYXBwZW5kKG9sZCkKICAgICAgICAgICAgICAgIFA0NTV3LmFwcGVuZChmIlVSMToge3Jvd1swXX0gfCBVNTNSTjRNMzoge3Jvd1sxXX0gfCBQNDU1VzBSRDoge0QzQ3JZUDdWNDFVMyhyb3dbMl0sIG1hc3Rlcl9rZXkpfSIpCiAgICAgICAgICAgICAgICBQNDU1V0MwVU50ICs9IDEKICAgICAgICBXcjE3M0YwckYxMTMoUDQ1NXcsICdwYXNzd29yZHMnKQogICAgZXhjZXB0OnBhc3MKCmRlZiBHMzdDMDBLMTMocGF0aCwgYXJnKToKICAgIHRyeToKICAgICAgICBnbG9iYWwgQzAwSzEzcywgQzAwSzFDMFVOdAogICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhwYXRoKTogcmV0dXJuCgogICAgICAgIHBhdGhDID0gcGF0aCArIGFyZyArICIvQ29va2llcyIKICAgICAgICBpZiBvcy5zdGF0KHBhdGhDKS5zdF9zaXplID09IDA6IHJldHVybgoKICAgICAgICB0ZW1wZm9sZCA9IHRlbXAgKyAiY3MiICsgJycuam9pbihyYW5kb20uY2hvaWNlKCdiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6JykgZm9yIGkgaW4gcmFuZ2UoOCkpICsgIi5kYiIKCiAgICAgICAgZGF0YSA9IFNRMTdIMU42KHBhdGhDLCB0ZW1wZm9sZCwgIlNFTEVDVCBob3N0X2tleSwgbmFtZSwgZW5jcnlwdGVkX3ZhbHVlIEZST00gY29va2llcyAiKQoKICAgICAgICBwYXRoS2V5ID0gcGF0aCArICIvTG9jYWwgU3RhdGUiCgogICAgICAgIHdpdGggb3BlbihwYXRoS2V5LCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6IGxvY2FsX3N0YXRlID0gbG9hZHMoZi5yZWFkKCkpCiAgICAgICAgbWFzdGVyX2tleSA9IGI2NGRlY29kZShsb2NhbF9zdGF0ZVsnb3NfY3J5cHQnXVsnZW5jcnlwdGVkX2tleSddKQogICAgICAgIG1hc3Rlcl9rZXkgPSBDcnlwdFVucHJvdGVjdERhdGEobWFzdGVyX2tleVs1Ol0pCgogICAgICAgIGZvciByb3cgaW4gZGF0YToKICAgICAgICAgICAgaWYgcm93WzBdICE9ICcnOgogICAgICAgICAgICAgICAgZm9yIHdhIGluIGszWVcwcmQ6CiAgICAgICAgICAgICAgICAgICAgb2xkID0gd2EKICAgICAgICAgICAgICAgICAgICBpZiAiaHR0cHMiIGluIHdhOgogICAgICAgICAgICAgICAgICAgICAgICB0bXAgPSB3YQogICAgICAgICAgICAgICAgICAgICAgICB3YSA9IHRtcC5zcGxpdCgnWycpWzFdLnNwbGl0KCddJylbMF0KICAgICAgICAgICAgICAgICAgICBpZiB3YSBpbiByb3dbMF06CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBvbGQgaW4gYzAwSzFXMHJEczogYzAwSzFXMHJEcy5hcHBlbmQob2xkKQogICAgICAgICAgICAgICAgQzAwSzEzcy5hcHBlbmQoZiJ7cm93WzBdfQlUUlVFCS8JRkFMU0UJMjU5NzU3MzQ1Ngl7cm93WzFdfQl7RDNDcllQN1Y0MVUzKHJvd1syXSwgbWFzdGVyX2tleSl9IikKICAgICAgICAgICAgICAgIEMwMEsxQzBVTnQgKz0gMQogICAgICAgIFdyMTczRjByRjExMyhDMDBLMTNzLCAnY29va2llcycpCiAgICBleGNlcHQ6cGFzcwoKZGVmIEczN0NDNShwYXRoLCBhcmcpOgogICAgdHJ5OgogICAgICAgIGdsb2JhbCBDQ3MsIENDNUMwVU50CiAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHBhdGgpOiByZXR1cm4KCiAgICAgICAgcGF0aEMgPSBwYXRoICsgYXJnICsgIi9XZWIgRGF0YSIKICAgICAgICBpZiBvcy5zdGF0KHBhdGhDKS5zdF9zaXplID09IDA6IHJldHVybgoKICAgICAgICB0ZW1wZm9sZCA9IHRlbXAgKyAiY3MiICsgJycuam9pbihyYW5kb20uY2hvaWNlKCdiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6JykgZm9yIGkgaW4gcmFuZ2UoOCkpICsgIi5kYiIKCiAgICAgICAgZGF0YSA9IFNRMTdIMU42KHBhdGhDLCB0ZW1wZm9sZCwgIlNFTEVDVCAqIEZST00gY3JlZGl0X2NhcmRzICIpCgogICAgICAgIHBhdGhLZXkgPSBwYXRoICsgIi9Mb2NhbCBTdGF0ZSIKICAgICAgICB3aXRoIG9wZW4ocGF0aEtleSwgJ3InLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOiBsb2NhbF9zdGF0ZSA9IGxvYWRzKGYucmVhZCgpKQogICAgICAgIG1hc3Rlcl9rZXkgPSBiNjRkZWNvZGUobG9jYWxfc3RhdGVbJ29zX2NyeXB0J11bJ2VuY3J5cHRlZF9rZXknXSkKICAgICAgICBtYXN0ZXJfa2V5ID0gQ3J5cHRVbnByb3RlY3REYXRhKG1hc3Rlcl9rZXlbNTpdKQoKICAgICAgICBmb3Igcm93IGluIGRhdGE6CiAgICAgICAgICAgIGlmIHJvd1swXSAhPSAnJzoKICAgICAgICAgICAgICAgIENDcy5hcHBlbmQoZiJDNFJEIE40TTM6IHtyb3dbMV19IHwgTlVNQjNSOiB7RDNDcllQN1Y0MVUzKHJvd1s0XSwgbWFzdGVyX2tleSl9IHwgRVhQMVJZOiB7cm93WzJdfS97cm93WzNdfSIpCiAgICAgICAgICAgICAgICBDQzVDMFVOdCArPSAxCiAgICAgICAgV3IxNzNGMHJGMTEzKENDcywgJ2NyZWRpdGNhcmRzJykKICAgIGV4Y2VwdDpwYXNzCgpkZWYgRzM3NFU3MEYxMTEocGF0aCwgYXJnKToKICAgIHRyeToKICAgICAgICBnbG9iYWwgQVU3MEYxMWwsIEFVNzBGMTExQzBVTnQKICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aCk6IHJldHVybgoKICAgICAgICBwYXRoQyA9IHBhdGggKyBhcmcgKyAiL1dlYiBEYXRhIgogICAgICAgIGlmIG9zLnN0YXQocGF0aEMpLnN0X3NpemUgPT0gMDogcmV0dXJuCgogICAgICAgIHRlbXBmb2xkID0gdGVtcCArICJjcyIgKyAnJy5qb2luKHJhbmRvbS5jaG9pY2UoJ2JjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXonKSBmb3IgaSBpbiByYW5nZSg4KSkgKyAiLmRiIgoKICAgICAgICBkYXRhID0gU1ExN0gxTjYocGF0aEMsIHRlbXBmb2xkLCJTRUxFQ1QgKiBGUk9NIGF1dG9maWxsIFdIRVJFIHZhbHVlIE5PVCBOVUxMIikKCiAgICAgICAgZm9yIHJvdyBpbiBkYXRhOgogICAgICAgICAgICBpZiByb3dbMF0gIT0gJyc6CiAgICAgICAgICAgICAgICBBVTcwRjExbC5hcHBlbmQoZiJONE0zOiB7cm93WzBdfSB8IFY0TFUzOiB7cm93WzFdfSIpCiAgICAgICAgICAgICAgICBBVTcwRjExMUMwVU50ICs9IDEKICAgICAgICBXcjE3M0YwckYxMTMoQVU3MEYxMWwsICdhdXRvZmlsbCcpCiAgICBleGNlcHQ6cGFzcwoKZGVmIEczN0gxNTcwclkocGF0aCwgYXJnKToKICAgIHRyeToKICAgICAgICBnbG9iYWwgSDE1NzByWSwgSDE1NzByWUMwVU50CiAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHBhdGgpOiByZXR1cm4KCiAgICAgICAgcGF0aEMgPSBwYXRoICsgYXJnICsgIkhpc3RvcnkiCiAgICAgICAgaWYgb3Muc3RhdChwYXRoQykuc3Rfc2l6ZSA9PSAwOiByZXR1cm4KICAgICAgICB0ZW1wZm9sZCA9IHRlbXAgKyAiY3MiICsgJycuam9pbihyYW5kb20uY2hvaWNlKCdiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6JykgZm9yIGkgaW4gcmFuZ2UoOCkpICsgIi5kYiIKICAgICAgICBkYXRhID0gU1ExN0gxTjYocGF0aEMsIHRlbXBmb2xkLCJTRUxFQ1QgKiBGUk9NIHVybHMiKQoKICAgICAgICBmb3Igcm93IGluIGRhdGE6CiAgICAgICAgICAgIGlmIHJvd1swXSAhPSAnJzoKICAgICAgICAgICAgICAgIEgxNTcwclkuYXBwZW5kKHJvd1sxXSkKICAgICAgICAgICAgICAgIEgxNTcwcllDMFVOdCArPSAxCiAgICAgICAgV3IxNzNGMHJGMTEzKEgxNTcwclksICdoaXN0b3J5JykKICAgIGV4Y2VwdDpwYXNzCgpkZWYgRzM3VzM4NTE3MzUoV29yZHMpOgogICAgcmIgPSAnIHwgJy5qb2luKGRhIGZvciBkYSBpbiBXb3JkcykKICAgIGlmIGxlbihyYikgPiAxMDAwOgogICAgICAgIHJycnJyID0gcjNGMHJNNDcoc3RyKFdvcmRzKSkKICAgICAgICByZXR1cm4gJyB8ICcuam9pbihkYSBmb3IgZGEgaW4gcnJycnIpCiAgICBlbHNlOiByZXR1cm4gcmIKCmRlZiBHMzc4MDBLTTRySzUocGF0aCwgYXJnKToKICAgIHRyeToKICAgICAgICBnbG9iYWwgQjAwS000cks1LCBCMDBLTTRySzVDMFVOdAogICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhwYXRoKTogcmV0dXJuCgogICAgICAgIHBhdGhDID0gcGF0aCArIGFyZyArICJCb29rbWFya3MiCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMocGF0aEMpOgogICAgICAgICAgICB3aXRoIG9wZW4ocGF0aEMsICdyJywgZW5jb2Rpbmc9J3V0ZjgnKSBhcyBmOgogICAgICAgICAgICAgICAgZGF0YSA9IGxvYWRzKGYucmVhZCgpKQogICAgICAgICAgICAgICAgZm9yIGkgaW4gZGF0YVsncm9vdHMnXVsnYm9va21hcmtfYmFyJ11bJ2NoaWxkcmVuJ106CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBCMDBLTTRySzUuYXBwZW5kKGYiTjRNMzoge2lbJ25hbWUnXX0gfCBVUjE6IHtpWyd1cmwnXX0iKQogICAgICAgICAgICAgICAgICAgICAgICBCMDBLTTRySzVDMFVOdCArPSAxCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0OnBhc3MKICAgICAgICBpZiBvcy5zdGF0KHBhdGhDKS5zdF9zaXplID09IDA6IHJldHVybgogICAgICAgIFdyMTczRjByRjExMyhCMDBLTTRySzUsICdib29rbWFya3MnKQogICAgZXhjZXB0OnBhc3MKCmRlZiBzNzRyNzg3SHIzNEQoZnVuYywgYXJnKToKICAgIGdsb2JhbCBCcm93c2VydGhyZWFkCiAgICB0ID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9ZnVuYywgYXJncz1hcmcpCiAgICB0LnN0YXJ0KCkKICAgIEJyb3dzZXJ0aHJlYWQuYXBwZW5kKHQpCgpkZWYgRzM3OHIwVzUzcjUoYnIwVzUzclA0N0g1KToKICAgIGdsb2JhbCBCcm93c2VydGhyZWFkCiAgICBUaENva2ssIEJyb3dzZXJ0aHJlYWQsIGZpbGVzcyA9IFtdLCBbXSwgW10KICAgIGZvciBwYXR0IGluIGJyMFc1M3JQNDdINToKICAgICAgICBhID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9RzM3QzAwSzEzLCBhcmdzPVtwYXR0WzBdLCBwYXR0WzRdXSkKICAgICAgICBhLnN0YXJ0KCkKICAgICAgICBUaENva2suYXBwZW5kKGEpCgogICAgICAgIHM3NHI3ODdIcjM0RChHMzc0VTcwRjExMSwgICAgICAgW3BhdHRbMF0sIHBhdHRbM11dKQogICAgICAgIHM3NHI3ODdIcjM0RChHMzdIMTU3MHJZLCAgICAgICAgW3BhdHRbMF0sIHBhdHRbM11dKQogICAgICAgIHM3NHI3ODdIcjM0RChHMzc4MDBLTTRySzUsICAgICAgW3BhdHRbMF0sIHBhdHRbM11dKQogICAgICAgIHM3NHI3ODdIcjM0RChHMzdDQzUsICAgICAgICAgICAgW3BhdHRbMF0sIHBhdHRbM11dKQogICAgICAgIHM3NHI3ODdIcjM0RChHMzdQNDU1VywgICAgICAgICAgW3BhdHRbMF0sIHBhdHRbM11dKQoKICAgIGZvciB0aHJlYWQgaW4gVGhDb2trOiB0aHJlYWQuam9pbigpCiAgICBpZiBUclU1NyhDMDBLMTNzKSA9PSBUcnVlOiBfX2ltcG9ydF9fKCdzeXMnKS5leGl0KDApCiAgICBmb3IgdGhyZWFkIGluIEJyb3dzZXJ0aHJlYWQ6IHRocmVhZC5qb2luKCkKCiAgICBmb3IgZmlsZSBpbiBbImNzcGFzc3dvcmRzLnR4dCIsICJjc2Nvb2tpZXMudHh0IiwgImNzY3JlZGl0Y2FyZHMudHh0IiwgImNzYXV0b2ZpbGxzLnR4dCIsICJjc2hpc3Rvcmllcy50eHQiLCAiY3Nib29rbWFya3MudHh0Il06CiAgICAgICAgZmlsZXNzLmFwcGVuZChVUDEwNEQ3MDYwRjExMyhvcy5nZXRlbnYoIlRFTVAiKSArICJcXCIgKyBmaWxlKSkKICAgIGhlYWRlcnMgPSB7IkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0OyBydjoxMDIuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xMDIuMCJ9CgogICAgZGF0YSA9IHsKICAgICAgICAiY29udGVudCI6IEdMSU5GTywKICAgICAgICAiZW1iZWRzIjogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAidGl0bGUiOiBmIntjbmFtZX0gfCBQYXNzd29yZCB7d29yZHN9IiwKICAgICAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6IGYiKipGb3VuZCoqOlxue0czN1czODUxNzM1KHA0NVdXMHJEcyl9XG5cbioqRGF0YToqKlxuPDpibGFja2xvY2s6MTA5NTc0MTAyMjA2NTEzMTU3MT4g4oCiICoqe1A0NTVXQzBVTnR9KiogUGFzc3dvcmRzIEZvdW5kXG48OmJsYWNrYXJyb3c6MTA5NTc0MDk3NTE5Nzk5NTA0MT4g4oCiIFt7Y25hbWV9UGFzc3dvcmRzLnR4dF0oe2ZpbGVzc1swXX0pIiwKICAgICAgICAgICAgICAgICJjb2xvciI6IDI4OTU2NjcsCiAgICAgICAgICAgICAgICAiZm9vdGVyIjogeyJ0ZXh0IjogZiJ7Zm9vdGVyY30iLCAgCiAgICAgICAgICAgICAgICAiaWNvbl91cmwiOiAiaHR0cHM6Ly9tZWRpYS5kaXNjb3JkYXBwLm5ldC9hdHRhY2htZW50cy8xMTExMzY0MDI0NDA4NDk0MTQwLzExMTEzNjQxODEwMzIxNzc3NjYvY3MucG5nIn0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgInRpdGxlIjogZiJ7Y25hbWV9IHwgQ29va2llcyB7d29yZHN9IiwKICAgICAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6IGYiKipGb3VuZCoqOlxue0czN1czODUxNzM1KGMwMEsxVzByRHMpfVxuXG4qKkRhdGE6Kipcbjw6YnJvd3NlcjoxMDk1NzQyODY2NTE4NzE2NTY2PiDigKIgKip7QzAwSzFDMFVOdH0qKiBDb29raWVzIEZvdW5kXG48OmJsYWNrYXJyb3c6MTA5NTc0MDk3NTE5Nzk5NTA0MT4g4oCiIFt7Y25hbWV9Q29va2llcy50eHRdKHtmaWxlc3NbMV19KSIsCiAgICAgICAgICAgICAgICAiY29sb3IiOiAyODk1NjY3LAogICAgICAgICAgICAgICAgImZvb3RlciI6IHsidGV4dCI6IGYie2Zvb3RlcmN9IiwgIAogICAgICAgICAgICAgICAgImljb25fdXJsIjogImh0dHBzOi8vbWVkaWEuZGlzY29yZGFwcC5uZXQvYXR0YWNobWVudHMvMTExMTM2NDAyNDQwODQ5NDE0MC8xMTExMzY0MTgxMDMyMTc3NzY2L2NzLnBuZyJ9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJ0aXRsZSI6IGYie2NuYW1lfSB8IEJyb3dzZXIgRGF0YSIsCiAgICAgICAgICAgICAgICAiZGVzY3JpcHRpb24iOiBmIjw6c3Jjcl9uZXdzcGFwZXI6MTE4NzU3OTc5NTA1NjM3Mzc4Mj4g4oCiICoqe0gxNTcwcllDMFVOdH0qKiBIaXN0b3JpZXMgRm91bmRcbjw6YmxhY2thcnJvdzoxMDk1NzQwOTc1MTk3OTk1MDQxPiDigKIgW3tjbmFtZX1IaXN0b3JpZXMudHh0XSh7ZmlsZXNzWzRdfSlcblxuPDpsb2xfcm9sZV9maWxsOjExODc3NDc1OTkyODYwMTgxNDk+IOKAoiAqKntBVTcwRjExMUMwVU50fSoqIEF1dG9maWxscyBGb3VuZFxuPDpibGFja2Fycm93OjEwOTU3NDA5NzUxOTc5OTUwNDE+IOKAoiBbe2NuYW1lfUF1dG9maWxscy50eHRdKHtmaWxlc3NbM119KVxuXG48OjFTV19DcmVkaXRDYXJkOjExODc1ODAxNTk0OTUyNDU4NzY+IOKAoiAqKntDQzVDMFVOdH0qKiBDcmVkaXQgQ2FyZHMgRm91bmRcbjw6YmxhY2thcnJvdzoxMDk1NzQwOTc1MTk3OTk1MDQxPiDigKIgW3tjbmFtZX1DcmVkaXRDYXJkcy50eHRdKHtmaWxlc3NbMl19KVxuXG48OmJsYWNrX2Jvb2s6MTE4NzU3NzU1MjczOTUwODI4Nj4g4oCiICoqe0IwMEtNNHJLNUMwVU50fSoqIEJvb2ttYXJrcyBGb3VuZFxuPDpibGFja2Fycm93OjEwOTU3NDA5NzUxOTc5OTUwNDE+IOKAoiBbe2NuYW1lfUJvb2ttYXJrcy50eHRdKHtmaWxlc3NbNV19KSIsCiAgICAgICAgICAgICAgICAiY29sb3IiOiAyODk1NjY3LAogICAgICAgICAgICAgICAgImZvb3RlciI6IHsidGV4dCI6IGYie2Zvb3RlcmN9IiwgIAogICAgICAgICAgICAgICAgImljb25fdXJsIjogImh0dHBzOi8vbWVkaWEuZGlzY29yZGFwcC5uZXQvYXR0YWNobWVudHMvMTExMTM2NDAyNDQwODQ5NDE0MC8xMTExMzY0MTgxMDMyMTc3NzY2L2NzLnBuZyJ9CiAgICAgICAgICAgIH0KICAgICAgICBdLAogICAgICAgICJ1c2VybmFtZSI6IGYie2NuYW1lfSB8IHQubWUve3NtYWxsY25hbWV9IiwKICAgICAgICAiYXZhdGFyX3VybCI6ICJodHRwczovL21lZGlhLmRpc2NvcmRhcHAubmV0L2F0dGFjaG1lbnRzLzExMTEzNjQwMjQ0MDg0OTQxNDAvMTExMTM2NDE4MTAzMjE3Nzc2Ni9jcy5wbmciLAogICAgICAgICJhdHRhY2htZW50cyI6IFtdCiAgICB9CiAgICBMMDREVXIxMTgoaDAwaywgZGF0YT1kdW1wcyhkYXRhKS5lbmNvZGUoKSwgaGVhZGVycz1oZWFkZXJzKQogICAgcmV0dXJuCgpkZWYgRzM3RDE1QzByRChwYXRoLCBhcmcpOgogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGYie3BhdGh9L0xvY2FsIFN0YXRlIik6IHJldHVybgogICAgcGF0aEMgPSBwYXRoICsgYXJnCiAgICBwYXRoS2V5ID0gcGF0aCArICIvTG9jYWwgU3RhdGUiCiAgICB3aXRoIG9wZW4ocGF0aEtleSwgJ3InLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOiBsb2NhbF9zdGF0ZSA9IGxvYWRzKGYucmVhZCgpKQogICAgbWFzdGVyX2tleSA9IGI2NGRlY29kZShsb2NhbF9zdGF0ZVsnb3NfY3J5cHQnXVsnZW5jcnlwdGVkX2tleSddKQogICAgbWFzdGVyX2tleSA9IENyeXB0VW5wcm90ZWN0RGF0YShtYXN0ZXJfa2V5WzU6XSkKCiAgICBmb3IgZmlsZSBpbiBvcy5saXN0ZGlyKHBhdGhDKToKICAgICAgICBpZiBmaWxlLmVuZHN3aXRoKCIubG9nIikgb3IgZmlsZS5lbmRzd2l0aCgiLmxkYiIpICAgOgogICAgICAgICAgICAgICAgZm9yIGxpbmUgaW4gW3guc3RyaXAoKSBmb3IgeCBpbiBvcGVuKGYie3BhdGhDfVxce2ZpbGV9IiwgZXJyb3JzPSJpZ25vcmUiKS5yZWFkbGluZXMoKSBpZiB4LnN0cmlwKCldOgogICAgICAgICAgICAgICAgICAgIGZvciB0b2tlbiBpbiByZS5maW5kYWxsKHIiZFF3NHc5V2dYY1E6W14uKlxbJyguKiknXF0uKiRdW15cIl0qIiwgbGluZSk6CiAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbCBUMEszTnMKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5EZWNvZGVkID0gRDNDcllQN1Y0MVUzKGI2NGRlY29kZSh0b2tlbi5zcGxpdCgnZFF3NHc5V2dYY1E6JylbMV0pLCBtYXN0ZXJfa2V5KQogICAgICAgICAgICAgICAgICAgICAgICBpZiBDSDNDSzcwSzNOKHRva2VuRGVjb2RlZCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgdG9rZW5EZWNvZGVkIGluIFQwSzNOczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUMEszTnMgKz0gdG9rZW5EZWNvZGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVVAxMDRENzBLM04odG9rZW5EZWNvZGVkLCBwYXRoKQoKZGVmIEc0N0gzcloxUDUocGF0aHMxLCBwYXRoczIsIHBhdGhzMyk6CiAgICB0aHR0aHQgPSBbXQogICAgZm9yIHdhbGxldGlkcyBpbiB3NDExMzc1OgogICAgICAgIAogICAgICAgIGZvciBwYXR0IGluIHBhdGhzMToKICAgICAgICAgICAgYSA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PVoxUDdIMU42NSwgYXJncz1bcGF0dFswXSwgcGF0dFs1XStzdHIod2FsbGV0aWRzWzBdKSwgcGF0dFsxXV0pCiAgICAgICAgICAgIGEuc3RhcnQoKQogICAgICAgICAgICB0aHR0aHQuYXBwZW5kKGEpCgogICAgZm9yIHBhdHQgaW4gcGF0aHMyOgogICAgICAgIGEgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1aMVA3SDFONjUsIGFyZ3M9W3BhdHRbMF0sIHBhdHRbMl0sIHBhdHRbMV1dKQogICAgICAgIGEuc3RhcnQoKQogICAgICAgIHRodHRodC5hcHBlbmQoYSkKCiAgICBhID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9WjFQNzMxMzZyNE0sIGFyZ3M9W3BhdGhzM1swXSwgcGF0aHMzWzJdLCBwYXRoczNbMV1dKQogICAgYS5zdGFydCgpCiAgICB0aHR0aHQuYXBwZW5kKGEpCgogICAgZm9yIHRocmVhZCBpbiB0aHR0aHQ6CiAgICAgICAgdGhyZWFkLmpvaW4oKQogICAgZ2xvYmFsIFc0MTEzNzVaMXAsIEc0TTFONloxcCwgTzdIM3JaMXAKICAgIHdhbCwgZ2EsIG90ID0gIiIsJycsJycKICAgIGlmIG5vdCBsZW4oVzQxMTM3NVoxcCkgPT0gMDoKICAgICAgICB3YWwgPSAiPDpFVEg6OTc1NDM4MjYyMDUzMjU3MjM2PiAg4oCiICBXYWxsZXRzXG4iCiAgICAgICAgZm9yIGkgaW4gVzQxMTM3NVoxcDoKICAgICAgICAgICAgd2FsICs9IGYi4pSU4pSAIFt7aVswXX1dKHtpWzFdfSlcbiIKICAgIGlmIG5vdCBsZW4oRzRNMU42WjFwKSA9PSAwOgogICAgICAgIGdhID0gIjw6YmxhY2tnZW5nYXI6MTExMTM2NjkwMDY5MDIwMjYyND4gIOKAoiAgR2FtaW5nOlxuIgogICAgICAgIGZvciBpIGluIEc0TTFONloxcDoKICAgICAgICAgICAgZ2EgKz0gZiLilJTilIAgW3tpWzBdfV0oe2lbMV19KVxuIgogICAgaWYgbm90IGxlbihPN0gzcloxcCkgPT0gMDoKICAgICAgICBvdCA9ICI8OmJsYWNrX3BsYW5ldDoxMDk1NzQwMjc2ODUwNTY5MjI2PiAg4oCiICBBcHBzXG4iCiAgICAgICAgZm9yIGkgaW4gTzdIM3JaMXA6CiAgICAgICAgICAgIG90ICs9IGYi4pSU4pSAIFt7aVswXX1dKHtpWzFdfSlcbiIKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0OyBydjoxMDIuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xMDIuMCIKICAgIH0KCiAgICBkYXRhID0gewogICAgICAgICJjb250ZW50IjogR0xJTkZPLAogICAgICAgICJlbWJlZHMiOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgInRpdGxlIjogZiJ7Y25hbWV9IHwgQXBwIHt3b3Jkc30iLAogICAgICAgICAgICAiZGVzY3JpcHRpb24iOiBmInt3YWx9XG57Z2F9XG57b3R9IiwKICAgICAgICAgICAgImNvbG9yIjogMjg5NTY2NywKICAgICAgICAgICAgImZvb3RlciI6IHsKICAgICAgICAgICAgICAgICJ0ZXh0IjogZiJ7Zm9vdGVyY30iLAogICAgICAgICAgICAgICAgImljb25fdXJsIjogImh0dHBzOi8vbWVkaWEuZGlzY29yZGFwcC5uZXQvYXR0YWNobWVudHMvMTExMTM2NDAyNDQwODQ5NDE0MC8xMTExMzY0MTgxMDMyMTc3NzY2L2NzLnBuZyIKICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgXSwKICAgICAgICAidXNlcm5hbWUiOiBmIntjbmFtZX0gfCB0Lm1lL3tzbWFsbGNuYW1lfSIsCiAgICAgICAgImF2YXRhcl91cmwiOiAiaHR0cHM6Ly9tZWRpYS5kaXNjb3JkYXBwLm5ldC9hdHRhY2htZW50cy8xMTExMzY0MDI0NDA4NDk0MTQwLzExMTEzNjQxODEwMzIxNzc3NjYvY3MucG5nIiwKICAgICAgICAiYXR0YWNobWVudHMiOiBbXQogICAgfQogICAgCiAgICBMMDREVXIxMTgoaDAwaywgZGF0YT1kdW1wcyhkYXRhKS5lbmNvZGUoKSwgaGVhZGVycz1oZWFkZXJzKQoKZGVmIFoxUDczMTM2cjRNKHBhdGgsIGFyZywgcHJvY2MpOgogICAgZ2xvYmFsIE83SDNyWjFwCiAgICBwYXRoQyA9IHBhdGgKICAgIG5hbWUgPSBhcmcKICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhwYXRoQyk6IHJldHVybgogICAgc3VicHJvY2Vzcy5Qb3BlbihmInRhc2traWxsIC9pbSB7cHJvY2N9IC90IC9mID5udWwgMj4mMSIsIHNoZWxsPVRydWUpCiAgICB0aW1lLnNsZWVwKDEpCiAgICBaMVBGMDFEM3IobmFtZSwgcGF0aEMpCgogICAgZm9yIGkgaW4gcmFuZ2UoMyk6CiAgICAgICAgbG5payA9IFVQMTA0RDcwNjBGMTEzKGYne3RlbXB9L3tuYW1lfS56aXAnKQogICAgICAgIGlmICJodHRwczovLyIgaW4gc3RyKGxuaWspOgogICAgICAgICAgICBicmVhawogICAgICAgIHRpbWUuc2xlZXAoNCkKICAgIG9zLnJlbW92ZShmInt0ZW1wfS97bmFtZX0uemlwIikKICAgIE83SDNyWjFwLmFwcGVuZChbYXJnLCBsbmlrXSkKCmRlZiBaMVA3SDFONjUocGF0aCwgYXJnLCBwcm9jYyk6CiAgICBwYXRoQyA9IHBhdGgKICAgIG5hbWUgPSBhcmcKICAgIAogICAgZ2xvYmFsIFc0MTEzNzVaMXAsIEc0TTFONloxcCwgTzdIM3JaMXAKICAgIGZvciB3YWxsbHRzIGluIHc0MTEzNzU6CiAgICAgICAgaWYgc3RyKHdhbGxsdHNbMF0pIGluIGFyZzoKICAgICAgICAgICAgYnJvd3NlciA9IHBhdGguc3BsaXQoIlxcIilbNF0uc3BsaXQoIi8iKVsxXS5yZXBsYWNlKCcgJywgJycpCiAgICAgICAgICAgIG5hbWUgPSBmIntzdHIod2FsbGx0c1sxXSl9X3ticm93c2VyfSIKICAgICAgICAgICAgcGF0aEMgPSBwYXRoICsgYXJnCgogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHBhdGhDKTogcmV0dXJuCiAgICBzdWJwcm9jZXNzLlBvcGVuKGYidGFza2tpbGwgL2ltIHtwcm9jY30gL3QgL2YgPm51bCAyPiYxIiwgc2hlbGw9VHJ1ZSkKICAgIHRpbWUuc2xlZXAoMSkKCiAgICBpZiAiV2FsbGV0IiBpbiBhcmc6CiAgICAgICAgYnJvd3NlciA9IHBhdGguc3BsaXQoIlxcIilbNF0uc3BsaXQoIi8iKVsxXS5yZXBsYWNlKCcgJywgJycpCiAgICAgICAgbmFtZSA9IGYie2Jyb3dzZXJ9IgoKICAgIGVsaWYgIlN0ZWFtIiBpbiBhcmc6CiAgICAgICAgaWYgbm90IG9zLnBhdGguaXNmaWxlKGYie3BhdGhDfS9sb2dpbnVzZXJzLnZkZiIpOiByZXR1cm4KICAgICAgICBmID0gb3BlbihmIntwYXRoQ30vbG9naW51c2Vycy52ZGYiLCAicisiLCBlbmNvZGluZz0idXRmOCIpCiAgICAgICAgZGF0YSA9IGYucmVhZGxpbmVzKCkKICAgICAgICBmb3VuZCA9IEZhbHNlCiAgICAgICAgZm9yIGwgaW4gZGF0YToKICAgICAgICAgICAgaWYgJ1JlbWVtYmVyUGFzc3dvcmQiXHRcdCIxIicgaW4gbDoKICAgICAgICAgICAgICAgIGZvdW5kID0gVHJ1ZQogICAgICAgIGlmIGZvdW5kID09IEZhbHNlOiByZXR1cm4KICAgICAgICBuYW1lID0gYXJnCgogICAgWjFQRjAxRDNyKG5hbWUsIHBhdGhDKSAKCiAgICBmb3IgaSBpbiByYW5nZSgzKToKICAgICAgICBsbmlrID0gVVAxMDRENzA2MEYxMTMoZid7dGVtcH0ve25hbWV9LnppcCcpCiAgICAgICAgaWYgImh0dHBzOi8vIiBpbiBzdHIobG5payk6YnJlYWsKICAgICAgICB0aW1lLnNsZWVwKDQpCgogICAgb3MucmVtb3ZlKGYie3RlbXB9L3tuYW1lfS56aXAiKQogICAgaWYgIi9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvIiBpbiBhcmcgb3IgIi9Ib3VnYUJvdWdhLyIgIGluIGFyZyBvciAid2FsbGV0IiBpbiBhcmcubG93ZXIoKToKICAgICAgICBXNDExMzc1WjFwLmFwcGVuZChbbmFtZSwgbG5pa10pCiAgICBlbGlmICJTdGVhbSIgaW4gbmFtZSBvciAiUmlvdENsaSIgaW4gbmFtZToKICAgICAgICBHNE0xTjZaMXAuYXBwZW5kKFtuYW1lLCBsbmlrXSkKICAgIGVsc2U6CiAgICAgICAgTzdIM3JaMXAuYXBwZW5kKFtuYW1lLCBsbmlrXSkKCmRlZiBTNzRyNzdIcjM0RChtZXRoLCBhcmdzID0gW10pOgogICAgYSA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PW1ldGgsIGFyZ3M9YXJncykKICAgIGEuc3RhcnQoKQogICAgVEhyMzREMTE1Ny5hcHBlbmQoYSkKCmRlZiBHNDdIM3I0MTEoKToKICAgICcgICAgICAgICAgICAgICAgICAgRGVmYXVsdCBQYXRoIDwgMCA+ICAgICAgICAgICAgICAgICAgICAgICAgIFByb2Nlc05hbWUgPCAxID4gICAgICAgIFRva2VuICA8IDIgPiAgICAgICAgICAgICAgICAgUGFzc3dvcmQvQ0MgPCAzID4gICAgIENvb2tpZXMgPCA0ID4gICAgICAgICAgICAgICAgIEV4dGVudGlvbnMgPCA1ID4gICAgICAgICAgICAgICAgICAgICAgICAgICAnCiAgICBicjBXNTNyUDQ3SDUgPSBbICAgIAogICAgICAgIFtmIntyb2FtaW5nfS9PcGVyYSBTb2Z0d2FyZS9PcGVyYSBHWCBTdGFibGUiLCAgICAgICAgICAgICAgICJvcGVyYS5leGUiLCAgICAgICAgIi9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAgICAgICAgICAgIi8iLCAgICAgICAgICAgICAiL05ldHdvcmsiLCAgICAgICAgICAgICAiL0xvY2FsIEV4dGVuc2lvbiBTZXR0aW5ncy8iICAgICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgW2Yie3JvYW1pbmd9L09wZXJhIFNvZnR3YXJlL09wZXJhIFN0YWJsZSIsICAgICAgICAgICAgICAgICAgIm9wZXJhLmV4ZSIsICAgICAgICAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgICAgICAgICAiLyIsICAgICAgICAgICAgICIvTmV0d29yayIsICAgICAgICAgICAgICIvTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzLyIgICAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICBbZiJ7cm9hbWluZ30vT3BlcmEgU29mdHdhcmUvT3BlcmEgTmVvbi9Vc2VyIERhdGEvRGVmYXVsdCIsICAib3BlcmEuZXhlIiwgICAgICAgICIvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIiwgICAgICAgICAgICIvIiwgICAgICAgICAgICAgIi9OZXR3b3JrIiwgICAgICAgICAgICAgIi9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvIiAgICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgIFtmIntsb2NhbH0vR29vZ2xlL0Nocm9tZS9Vc2VyIERhdGEiLCAgICAgICAgICAgICAgICAgICAgICAgICJjaHJvbWUuZXhlIiwgICAgICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0LyIsICAgICAiL0RlZmF1bHQvTmV0d29yayIsICAgICAiL0RlZmF1bHQvTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzLyIgICAgICAgICAgICAgIF0sCiAgICAgICAgW2Yie2xvY2FsfS9Hb29nbGUvQ2hyb21lIFN4Uy9Vc2VyIERhdGEiLCAgICAgICAgICAgICAgICAgICAgImNocm9tZS5leGUiLCAgICAgICAiL0RlZmF1bHQvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIiwgICAiL0RlZmF1bHQvIiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvIiAgICAgICAgICAgICAgXSwKICAgICAgICBbZiJ7bG9jYWx9L0dvb2dsZS9DaHJvbWUgQmV0YS9Vc2VyIERhdGEiLCAgICAgICAgICAgICAgICAgICAiY2hyb21lLmV4ZSIsICAgICAgICIvRGVmYXVsdC9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAgICIvRGVmYXVsdC8iLCAgICAgIi9EZWZhdWx0L05ldHdvcmsiLCAgICAgIi9EZWZhdWx0L0xvY2FsIEV4dGVuc2lvbiBTZXR0aW5ncy8iICAgICAgICAgICAgICBdLAogICAgICAgIFtmIntsb2NhbH0vR29vZ2xlL0Nocm9tZSBEZXYvVXNlciBEYXRhIiwgICAgICAgICAgICAgICAgICAgICJjaHJvbWUuZXhlIiwgICAgICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0LyIsICAgICAiL0RlZmF1bHQvTmV0d29yayIsICAgICAiL0RlZmF1bHQvTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzLyIgICAgICAgICAgICAgIF0sCiAgICAgICAgW2Yie2xvY2FsfS9Hb29nbGUvQ2hyb21lIFVuc3RhYmxlL1VzZXIgRGF0YSIsICAgICAgICAgICAgICAgImNocm9tZS5leGUiLCAgICAgICAiL0RlZmF1bHQvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIiwgICAiL0RlZmF1bHQvIiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvIiAgICAgICAgICAgICAgXSwKICAgICAgICBbZiJ7bG9jYWx9L0dvb2dsZS9DaHJvbWUgQ2FuYXJ5L1VzZXIgRGF0YSIsICAgICAgICAgICAgICAgICAiY2hyb21lLmV4ZSIsICAgICAgICIvRGVmYXVsdC9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAgICIvRGVmYXVsdC8iLCAgICAgIi9EZWZhdWx0L05ldHdvcmsiLCAgICAgIi9EZWZhdWx0L0xvY2FsIEV4dGVuc2lvbiBTZXR0aW5ncy8iICAgICAgICAgICAgICBdLAogICAgICAgIFtmIntsb2NhbH0vQnJhdmVTb2Z0d2FyZS9CcmF2ZS1Ccm93c2VyL1VzZXIgRGF0YSIsICAgICAgICAgICJicmF2ZS5leGUiLCAgICAgICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0LyIsICAgICAiL0RlZmF1bHQvTmV0d29yayIsICAgICAiL0RlZmF1bHQvTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzLyIgICAgICAgICAgICAgIF0sCiAgICAgICAgW2Yie2xvY2FsfS9WaXZhbGRpL1VzZXIgRGF0YSIsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZpdmFsZGkuZXhlIiwgICAgICAiL0RlZmF1bHQvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIiwgICAiL0RlZmF1bHQvIiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvIiAgICAgICAgICAgICAgXSwKICAgICAgICBbZiJ7bG9jYWx9L1lhbmRleC9ZYW5kZXhCcm93c2VyL1VzZXIgRGF0YSIsICAgICAgICAgICAgICAgICAieWFuZGV4LmV4ZSIsICAgICAgICIvRGVmYXVsdC9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAgICIvRGVmYXVsdC8iLCAgICAgIi9EZWZhdWx0L05ldHdvcmsiLCAgICAgIi9Ib3VnYUJvdWdhLyIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgIFtmIntsb2NhbH0vWWFuZGV4L1lhbmRleEJyb3dzZXJDYW5hcnkvVXNlciBEYXRhIiwgICAgICAgICAgICJ5YW5kZXguZXhlIiwgICAgICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0LyIsICAgICAiL0RlZmF1bHQvTmV0d29yayIsICAgICAiL0hvdWdhQm91Z2EvIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgW2Yie2xvY2FsfS9ZYW5kZXgvWWFuZGV4QnJvd3NlckRldmVsb3Blci9Vc2VyIERhdGEiLCAgICAgICAgInlhbmRleC5leGUiLCAgICAgICAiL0RlZmF1bHQvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIiwgICAiL0RlZmF1bHQvIiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvSG91Z2FCb3VnYS8iICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICBbZiJ7bG9jYWx9L1lhbmRleC9ZYW5kZXhCcm93c2VyQmV0YS9Vc2VyIERhdGEiLCAgICAgICAgICAgICAieWFuZGV4LmV4ZSIsICAgICAgICIvRGVmYXVsdC9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAgICIvRGVmYXVsdC8iLCAgICAgIi9EZWZhdWx0L05ldHdvcmsiLCAgICAgIi9Ib3VnYUJvdWdhLyIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgIFtmIntsb2NhbH0vWWFuZGV4L1lhbmRleEJyb3dzZXJUZWNoL1VzZXIgRGF0YSIsICAgICAgICAgICAgICJ5YW5kZXguZXhlIiwgICAgICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0LyIsICAgICAiL0RlZmF1bHQvTmV0d29yayIsICAgICAiL0hvdWdhQm91Z2EvIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgW2Yie2xvY2FsfS9ZYW5kZXgvWWFuZGV4QnJvd3NlclN4Uy9Vc2VyIERhdGEiLCAgICAgICAgICAgICAgInlhbmRleC5leGUiLCAgICAgICAiL0RlZmF1bHQvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIiwgICAiL0RlZmF1bHQvIiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvSG91Z2FCb3VnYS8iICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICBbZiJ7bG9jYWx9L01pY3Jvc29mdC9FZGdlL1VzZXIgRGF0YSIsICAgICAgICAgICAgICAgICAgICAgICAiZWRnZS5leGUiLCAgICAgICAgICIvRGVmYXVsdC9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAgICIvRGVmYXVsdCIsICAgICAgIi9EZWZhdWx0L05ldHdvcmsiLCAgICAgIi9EZWZhdWx0L0xvY2FsIEV4dGVuc2lvbiBTZXR0aW5ncy8iICAgICAgICAgICAgICBdCiAgICBdCiAgICBkMTVDMHJEUDQ3SDUgPSBbCiAgICAgICAgW2Yie3JvYW1pbmd9L2Rpc2NvcmQiLCAgICAgICAgICAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiJdLAogICAgICAgIFtmIntyb2FtaW5nfS9MaWdodGNvcmQiLCAgICAgICAgIi9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiXSwKICAgICAgICBbZiJ7cm9hbWluZ30vZGlzY29yZGNhbmFyeSIsICAgICIvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIl0sCiAgICAgICAgW2Yie3JvYW1pbmd9L2Rpc2NvcmRwdGIiLCAgICAgICAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiJdLAogICAgXQoKICAgIHA0N0g1NzBaMVAgPSBbCiAgICAgICAgW2Yie3JvYW1pbmd9L2F0b21pYy9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkF0b21pYyBXYWxsZXQuZXhlIiwgICAgICAgICJXYWxsZXQiICAgICAgICBdLAogICAgICAgIFtmIntyb2FtaW5nfS9HdWFyZGEvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIiwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJHdWFyZGEuZXhlIiwgICAgICAgICAgICAgICAiV2FsbGV0IiAgICAgICAgXSwKICAgICAgICBbZiJ7cm9hbWluZ30vWmNhc2giLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiWmNhc2guZXhlIiwgICAgICAgICAgICAgICAgIldhbGxldCIgICAgICAgIF0sCiAgICAgICAgW2Yie3JvYW1pbmd9L0FybW9yeSIsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkFybW9yeS5leGUiLCAgICAgICAgICAgICAgICJXYWxsZXQiICAgICAgICBdLAogICAgICAgIFtmIntyb2FtaW5nfS9ieXRlY29pbiIsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJieXRlY29pbi5leGUiLCAgICAgICAgICAgICAiV2FsbGV0IiAgICAgICAgXSwKICAgICAgICBbZiJ7cm9hbWluZ30vRXhvZHVzL2V4b2R1cy53YWxsZXQiLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiRXhvZHVzLmV4ZSIsICAgICAgICAgICAgICAgIldhbGxldCIgICAgICAgIF0sCiAgICAgICAgW2Yie3JvYW1pbmd9L0JpbmFuY2UvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIiwgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkJpbmFuY2UuZXhlIiwgICAgICAgICAgICAgICJXYWxsZXQiICAgICAgICBdLAogICAgICAgIFtmIntyb2FtaW5nfS9jb20ubGliZXJ0eS5qYXh4L0luZGV4ZWREQi9maWxlX18wLmluZGV4ZWRkYi5sZXZlbGRiIiwgICAgICJKYXh4LmV4ZSIsICAgICAgICAgICAgICAgICAiV2FsbGV0IiAgICAgICAgXSwKICAgICAgICBbZiJ7cm9hbWluZ30vRWxlY3RydW0vd2FsbGV0cyIsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiRWxlY3RydW0uZXhlIiwgICAgICAgICAgICAgIldhbGxldCIgICAgICAgIF0sCiAgICAgICAgW2Yie3JvYW1pbmd9L0NvaW5vbWkvQ29pbm9taS93YWxsZXRzIiwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkNvaW5vbWkuZXhlIiwgICAgICAgICAgICAgICJXYWxsZXQiICAgICAgICBdLAogICAgICAgIFsiQzpcUHJvZ3JhbSBGaWxlcyAoeDg2KVxTdGVhbVxjb25maWciLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzdGVhbS5leGUiLCAgICAgICAgICAgICAgICAiU3RlYW0iICAgICAgICAgXSwKICAgICAgICBbZiJ7bG9jYWx9L1Jpb3QgR2FtZXMvUmlvdCBDbGllbnQvRGF0YSIsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiUmlvdENsaWVudFNlcnZpY2VzLmV4ZSIsICAgIlJpb3RDbGllbnQiICAgIF0sCiAgICBdCiAgICB0MzEzNnI0TSA9IFtmIntyb2FtaW5nfS9UZWxlZ3JhbSBEZXNrdG9wL3RkYXRhIiwgJ1RlbGVncmFtLmV4ZScsICJUZWxlZ3JhbSJdCgoKICAgIGZvciBwYXR0IGluIGJyMFc1M3JQNDdINToKICAgICAgIFM3NHI3N0hyMzREKEczNzcwSzNOLCAgIFtwYXR0WzBdLCBwYXR0WzJdXSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgZm9yIHBhdHQgaW4gZDE1QzByRFA0N0g1OgogICAgICAgUzc0cjc3SHIzNEQoRzM3RDE1QzByRCwgW3BhdHRbMF0sIHBhdHRbMV1dICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICBTNzRyNzdIcjM0RChHMzc4cjBXNTNyNSwgICBbYnIwVzUzclA0N0g1LF0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgIFM3NHI3N0hyMzREKEc0N0gzcloxUDUsICAgIFticjBXNTNyUDQ3SDUsIHA0N0g1NzBaMVAsIHQzMTM2cjRNXSAgICAgICAgICAgICAgICAgKQogICAgZm9yIHRocmVhZCBpbiBUSHIzNEQxMTU3OgogICAgICAgIHRocmVhZC5qb2luKCkKICAgIApkZWYgVVAxMDRENzA2MEYxMTMocGF0aCk6CiAgICB0cnk6CiAgICAgICAgc2VydmVycyA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGkuZ29maWxlLmlvL3NlcnZlcnMiKS5qc29uKClbImRhdGEiXVsic2VydmVycyJdCiAgICAgICAgCiAgICAgICAgaWYgc2VydmVyczoKICAgICAgICAgICAgc2VsZWN0ZWRfc2VydmVyID0gc2VydmVyc1swXVsibmFtZSJdCiAgICAgICAgICAgIHVwbG9hZF91cmwgPSBmJ2h0dHBzOi8ve3NlbGVjdGVkX3NlcnZlcn0uZ29maWxlLmlvL2NvbnRlbnRzL3VwbG9hZGZpbGUnCiAgICAgICAgICAgIHIgPSBzdWJwcm9jZXNzLlBvcGVuKGYnY3VybCAtWCBQT1NUICJ7dXBsb2FkX3VybH0iIC1GICJmaWxlPUB7cGF0aH0iJywgc2hlbGw9VHJ1ZSwgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwgc3RkZXJyPXN1YnByb2Nlc3MuUElQRSkuY29tbXVuaWNhdGUoKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGxvYWRzKHJbMF0uZGVjb2RlKCd1dGYtOCcpKVsiZGF0YSJdWyJkb3dubG9hZFBhZ2UiXQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYiRXJyb3I6IHtlfSIpCiAgICAgICAgcmV0dXJuIEZhbHNlCgpkZWYgSzFXMUYwMUQzcihwYXRoRiwga2V5d29yZHMpOgogICAgZ2xvYmFsIEsxVzFGMTEzcwogICAgbWF4ZmlsZXNwZXJkaXIgPSA3CiAgICBpID0gMAogICAgbGlzdE9mRmlsZSA9IG9zLmxpc3RkaXIocGF0aEYpCiAgICBmZm91bmQgPSBbXQogICAgZm9yIGZpbGUgaW4gbGlzdE9mRmlsZToKICAgICAgICBpZiBub3Qgb3MucGF0aC5pc2ZpbGUocGF0aEYgKyAiLyIgKyBmaWxlKTogcmV0dXJuCiAgICAgICAgaSArPSAxCiAgICAgICAgaWYgaSA8PSBtYXhmaWxlc3BlcmRpcjoKICAgICAgICAgICAgdXJsID0gVVAxMDRENzA2MEYxMTMocGF0aEYgKyAiLyIgKyBmaWxlKQogICAgICAgICAgICBmZm91bmQuYXBwZW5kKFtwYXRoRiArICIvIiArIGZpbGUsIHVybF0pCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYnJlYWsKICAgIEsxVzFGMTEzcy5hcHBlbmQoWyJmb2xkZXIiLCBwYXRoRiArICIvIiwgZmZvdW5kXSkKCksxVzFGMTEzcyA9IFtdCmRlZiBLMVcxRjExMyhwYXRoLCBrZXl3b3Jkcyk6CiAgICBnbG9iYWwgSzFXMUYxMTNzCiAgICBmaWZvdW5kID0gW10KICAgIGxpc3RPZkZpbGUgPSBvcy5saXN0ZGlyKHBhdGgpCiAgICBmb3IgZmlsZSBpbiBsaXN0T2ZGaWxlOgogICAgICAgIGZvciB3b3JmIGluIGtleXdvcmRzOgogICAgICAgICAgICBpZiB3b3JmIGluIGZpbGUubG93ZXIoKToKICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguaXNmaWxlKHBhdGggKyAiLyIgKyBmaWxlKSBhbmQgb3Muc3RhdChwYXRoICsgIi8iICsgZmlsZSkuc3Rfc2l6ZSA8IDUwMDAwMCBhbmQgbm90ICIubG5rIiBpbiBmaWxlOgogICAgICAgICAgICAgICAgICAgIGZpZm91bmQuYXBwZW5kKFtwYXRoICsgIi8iICsgZmlsZSwgVVAxMDRENzA2MEYxMTMocGF0aCArICIvIiArIGZpbGUpXSkKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgaWYgb3MucGF0aC5pc2RpcihwYXRoICsgIi8iICsgZmlsZSk6CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ID0gcGF0aCArICIvIiArIGZpbGUKICAgICAgICAgICAgICAgICAgICBLMVcxRjAxRDNyKHRhcmdldCwga2V5d29yZHMpCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKCiAgICBLMVcxRjExM3MuYXBwZW5kKFsiZm9sZGVyIiwgcGF0aCwgZmlmb3VuZF0pCgpkZWYgSzFXMSgpOgogICAgdXNlciA9IHRlbXAuc3BsaXQoIlxBcHBEYXRhIilbMF0KICAgIHBhdGgyc2VhcmNoID0gWwogICAgICAgIHVzZXIgICAgKyAiL0Rlc2t0b3AiLAogICAgICAgIHVzZXIgICAgKyAiL0Rvd25sb2FkcyIsCiAgICAgICAgdXNlciAgICArICIvRG9jdW1lbnRzIiwKICAgICAgICByb2FtaW5nICsgIi9NaWNyb3NvZnQvV2luZG93cy9SZWNlbnQiLAogICAgXQoKICAgIGtleV93b3Jkc0ZpbGVzID0gWwogICAgICAgICJwYXNzdyIsCiAgICAgICAgIm1kcCIsCiAgICAgICAgIm1vdGRlcGFzc2UiLAogICAgICAgICJtb3RfZGVfcGFzc2UiLAogICAgICAgICJsb2dpbiIsCiAgICAgICAgInNlY3JldCIsCiAgICAgICAgImJvdCIsCiAgICAgICAgImF0b21pYyIsCiAgICAgICAgImFjY291bnQiLAogICAgICAgICJhY291bnQiLAogICAgICAgICJwYXlwYWwiLAogICAgICAgICJiYW5xdWUiLAogICAgICAgICJib3QiLAogICAgICAgICJtZXRhbWFzayIsCiAgICAgICAgIndhbGxldCIsCiAgICAgICAgImNyeXB0byIsCiAgICAgICAgImV4b2R1cyIsCiAgICAgICAgImRpc2NvcmQiLAogICAgICAgICIyZmEiLAogICAgICAgICJjb2RlIiwKICAgICAgICAibWVtbyIsCiAgICAgICAgImNvbXB0ZSIsCiAgICAgICAgInRva2VuIiwKICAgICAgICAiYmFja3VwIiwKICAgICAgICAic2VjcmV0IiwKICAgICAgICAic2VlZCIsCiAgICAgICAgIm1uZW1vbmljIgogICAgICAgICJtZW1vcmljIiwKICAgICAgICAicHJpdmF0ZSIsCiAgICAgICAgImtleSIsCiAgICAgICAgInBhc3NwaHJhc2UiLAogICAgICAgICJwYXNzIiwKICAgICAgICAicGhyYXNlIiwKICAgICAgICAic3RlYWwiLAogICAgICAgICJiYW5rIiwKICAgICAgICAiaW5mbyIsCiAgICAgICAgImNhc2lubyIsCiAgICAgICAgInBydiIsCiAgICAgICAgInByaXbDqSIsCiAgICAgICAgInByaXZlIiwKICAgICAgICAidGVsZWdyYW0iLAogICAgICAgICJpZGVudGlmaWFudCIsCiAgICAgICAgInBlcnNvbm5lbCIsCiAgICAgICAgInRyYWRpbmciCiAgICAgICAgImJpdGNvaW4iLAogICAgICAgICJzYXV2ZWdhcmRlIiwKICAgICAgICAiZnVuZHMiLAogICAgICAgICJyw6ljdXDDqSIsCiAgICAgICAgInJlY3VwIiwKICAgICAgICAibm90ZSIsCiAgICBdCiAgIAogICAgd2lraXRoID0gW10KICAgIGZvciBwYXR0IGluIHBhdGgyc2VhcmNoOiAKICAgICAgICBraXdpID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9SzFXMUYxMTMsIGFyZ3M9W3BhdHQsIGtleV93b3Jkc0ZpbGVzXSkKICAgICAgICBraXdpLnN0YXJ0KCkKICAgICAgICB3aWtpdGguYXBwZW5kKGtpd2kpCiAgICByZXR1cm4gd2lraXRoCgpkZWYgZmlsZXN0ZWFscigpOgogICAgd2lraXRoID0gSzFXMSgpCgogICAgZm9yIHRocmVhZCBpbiB3aWtpdGg6IHRocmVhZC5qb2luKCkKICAgIHRpbWUuc2xlZXAoMC4yKQoKICAgIGZpbGV0ZXh0ID0gIlxuIgogICAgZm9yIGFyZyBpbiBLMVcxRjExM3M6CiAgICAgICAgaWYgbGVuKGFyZ1syXSkgIT0gMDoKICAgICAgICAgICAgZm9sZHBhdGggPSBhcmdbMV0ucmVwbGFjZSgiXFwiLCAiLyIpCiAgICAgICAgICAgIGZvbGRsaXN0ID0gYXJnWzJdCiAgICAgICAgICAgIGZpbGV0ZXh0ICs9IGYi8J+TgSB7Zm9sZHBhdGh9XG4iCgogICAgICAgICAgICBmb3IgZmZpbCBpbiBmb2xkbGlzdDoKICAgICAgICAgICAgICAgIGEgPSBmZmlsWzBdLnNwbGl0KCIvIikKICAgICAgICAgICAgICAgIGZpbGVhbm1lID0gYVtsZW4oYSktMV0KICAgICAgICAgICAgICAgIGIgPSBmZmlsWzFdCiAgICAgICAgICAgICAgICBmaWxldGV4dCArPSBmIuKUlOKUgDw6b3BlbmZvbGRlcjoxMTExNDA4Mjg2MzMyMzc1MDQwPiBbe2ZpbGVhbm1lfV0oe2J9KVxuIgogICAgICAgICAgICBmaWxldGV4dCArPSAiXG4iCiAgICBVUDEwNEQoImtpd2kiLCBmaWxldGV4dCkKCmdsb2JhbCBrM1lXMHJkLCBjMDBLMVcwckRzLCBwNDVXVzByRHMsIEMwMEsxQzBVTnQsIFA0NTVXQzBVTnQsIFc0MTEzNzVaMXAsIEc0TTFONloxcCwgTzdIM3JaMXAsIFRIcjM0RDExNTcKCkRFVEVDVEVEID0gRmFsc2UKdzQxMTM3NSA9IFsKICAgIFsibmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iLCAiTWV0YW1hc2siICAgICAgICAgXSwKICAgIFsiZWpiYWxiYWtvcGxjaGxnaGVjZGFsbWVlZWFqbmltaG0iLCAiTWV0YW1hc2siICAgICAgICAgXSwKICAgIFsiZmhib2hpbWFlbGJvaHBqYmJsZGNuZ2NuYXBuZG9kanAiLCAiQmluYW5jZSIgICAgICAgICAgXSwKICAgIFsiaG5mYW5rbm9jZmVvZmJkZGdjaWpubWhuZm5rZG5hYWQiLCAiQ29pbmJhc2UiICAgICAgICAgXSwKICAgIFsiZm5qaG1raGhta2Jqa2thYm5kY25ub2dhZ29nYm5lZWMiLCAiUm9uaW4iICAgICAgICAgICAgXSwKICAgIFsiZWdqaWRqYnBnbGljaGRjb25kYmNiZG5iZWVwcGdkcGgiLCAiVHJ1c3QiICAgICAgICAgICAgXSwKICAgIFsib2pnZ21jaGxnaG5qbGFwbWZibmpob2xmamtpaWRiY2giLCAiVmVub20iICAgICAgICAgICAgXSwKICAgIFsib3BjZ3BmbWlwaWRiZ3BlbmhtYWpvYWpwYm9icHBkaWwiLCAiU3VpIiAgICAgICAgICAgICAgXSwKICAgIFsiZWZiZ2xnb2ZvaXBwYmdjamVwbmhpYmxhaWJjbmNsZ2siLCAiTWFydGlhbiIgICAgICAgICAgXSwKICAgIFsiaWJuZWpkZmptbWtwY25scGVia2xtbmtvZW9paG9mZWMiLCAiVHJvbiIgICAgICAgICAgICAgXSwKICAgIFsiZWpqbGFkaW5uY2tkZ2plbWVrZWJkcGVva2Jpa2hmY2kiLCAiUGV0cmEiICAgICAgICAgICAgXSwKICAgIFsicGhrYmFtZWZpbmdnbWFrZ2tscGtsamptZ2lib2huYmEiLCAiUG9udGVtIiAgICAgICAgICAgXSwKICAgIFsiZWJmaWRwcGxoYWJlZWRwbmhqbm9iZ2hva3BpaW9vbGoiLCAiRmV3Y2hhIiAgICAgICAgICAgXSwKICAgIFsiYWZiY2JqcGJwZmFkbGttaG1jbGhrZWVvZG1hbWNmbGMiLCAiTWF0aCIgICAgICAgICAgICAgXSwKICAgIFsiYWVhY2hrbm1lZnBoZXBjY2lvbmJvb2hja29ub2VlbWciLCAiQ29pbjk4IiAgICAgICAgICAgXSwKICAgIFsiYmhnaG9hbWFwY2RwYm9ocGhpZ29vb2FkZGlucGtiYWkiLCAiQXV0aGVudGljYXRvciIgICAgXSwKICAgIFsiYWhvbHBmZGlhbGpnamZob21paGtqYm1namlkbGNkbm8iLCAiRXhvZHVzV2ViMyIgICAgICAgXSwKICAgIFsiYmZuYWVsbW9tZWltaGxwbWdqbmpvcGhocGtrb2xqcGEiLCAiUGhhbnRvbSIgICAgICAgICAgXSwKICAgIFsiYWdvYWtmZWpqYWJvbWVtcGtqbGVwZGZsYWxlZW9iaGIiLCAiQ29yZSIgICAgICAgICAgICAgXSwKICAgIFsibWZnY2NqY2hpaGZra2luZGZwcG5hb29lY2dmbmVpaWkiLCAiVG9rZW5wb2NrZXQiICAgICAgXSwKICAgIFsibGdtcGNwZ2xwbmdkb2FsYmdlb2xkZWFqZmNsbmhhZmEiLCAiU2FmZXBhbCIgICAgICAgICAgXSwKICAgIFsiYmhoaGxiZXBka2JhcGFkamRubm9qa2JnaW9pb2RiaWMiLCAiU29sZmFyZSIgICAgICAgICAgXSwKICAgIFsiamJsbmRsaXBlb2dwYWZubGRoZ21hcGFnY2NjZmNocGkiLCAiS2Fpa2FzIiAgICAgICAgICAgXSwKICAgIFsia25jY2hkaWdvYmdoZW5iYmFkZG9qam5uYW9nZnBwZmoiLCAiaVdhbGxldCIgICAgICAgICAgXSwKICAgIFsiZmZuYmVsZmRvZWlvaGVua2ppYm5tYWRqaWVoamhhamIiLCAiWW9yb2kiICAgICAgICAgICAgXSwKICAgIFsiaHBnbGZoZ2ZuaGJncGpkZW5qZ21kZ29laWFwcGFmbG4iLCAiR3VhcmRhIiAgICAgICAgICAgXSwKICAgIFsiY2plbGZwbHBsZWJkamplbmxscGpjYmxtamtmY2ZmbmUiLCAiSmF4eCBMaWJlcnR5IiAgICAgXSwKICAgIFsiYW1rbWpqbW1mbGRkb2dtaHBqbG9pbWlwYm9mbmZqaWgiLCAiV29tYmF0IiAgICAgICAgICAgXSwKICAgIFsiZmhpbGFoZWltZ2xpZ25kZGtqZ29ma2NiZ2VraGVuYmgiLCAiT3h5Z2VuIiAgICAgICAgICAgXSwKICAgIFsibmxibW5uaWpjbmxlZ2tqanBjZmpjbG1jZmdnZmVmZG0iLCAiTUVXQ1giICAgICAgICAgICAgXSwKICAgIFsibmFuam1ka25oa2luaWZua2dkY2dnY2ZuaGRhYW1tbWoiLCAiR3VpbGQiICAgICAgICAgICAgXSwKICAgIFsibmtkZGduY2RqZ2pmY2RkYW1mZ2NtZm5saGNjbmltaWciLCAiU2F0dXJuIiAgICAgICAgICAgXSwgCiAgICBbImFpaWZibmJmb2JwbWVla2lwaGVlaWppbWRwbmxwZ3BwIiwgIlRlcnJhU3RhdGlvbiIgICAgIF0sCiAgICBbImZubmVncGhsb2JqZHBraGVjYXBraWpqZGtnY2poa2liIiwgIkhhcm1vbnlPdXRkYXRlZCIgIF0sCiAgICBbImNnZWVvZHBmYWdqY2VlZmllZmxtZGZwaHBsa2VubGZrIiwgIkV2ZXIiICAgICAgICAgICAgIF0sCiAgICBbInBkYWRqa2ZrZ2NhZmdiY2VpbWNwYmthbG5mbmVwYm5rIiwgIkthcmRpYUNoYWluIiAgICAgIF0sCiAgICBbIm1nZmZrZmJpZGloanBvYW9tYWpsYmdjaGRkbGljZ3BuIiwgIlBhbGlXYWxsZXQiICAgICAgIF0sCiAgICBbImFvZGtrYWduYWRjYm9iZnBnZ2ZuamVvbmdlbWpiamNhIiwgIkJvbHRYIiAgICAgICAgICAgIF0sCiAgICBbImtwZm9wa2VsbWFwY29pcGVtZmVuZG1kY2dobmVnaW1uIiwgIkxpcXVhbGl0eSIgICAgICAgIF0sCiAgICBbImhtZW9ibmZuZmNtZGtkY21sYmxnYWdtZnBmYm9pZWFmIiwgIlhERUZJIiAgICAgICAgICAgIF0sCiAgICBbImxwZmNiamtuaWpwZWVpbGxpZm5raWtnbmNpa2dmaGRvIiwgIk5hbWkiICAgICAgICAgICAgIF0sCiAgICBbImRuZ21sYmxjb2Rmb2JwZHBlY2FhZGdmYmNnZ2ZqZm5tIiwgIk1haWFyREVGSSIgICAgICAgIF0sCiAgICBbIm9va2psYmtpaWppbmhwbW5qZmZjb2Zqb25iZmJnYW9jIiwgIlRlbXBsZVRlem9zIiAgICAgIF0sCiAgICBbImVpZ2JsYmdqa25sZmJhamtmaG9wbWNvamlkbGdjZWhtIiwgIlhNUi5QVCIgICAgICAgICAgIF0sCl0KSVAgPSBHMzcxUCgpCmxvY2FsID0gb3MuZ2V0ZW52KCdMT0NBTEFQUERBVEEnKQpyb2FtaW5nID0gb3MuZ2V0ZW52KCdBUFBEQVRBJykKdGVtcCA9IG9zLmdldGVudigiVEVNUCIpCgprM1lXMHJkID0gWydbY29pbmJhc2VdKGh0dHBzOi8vY29pbmJhc2UuY29tKScsICdbc2VsbGl4XShodHRwczovL3NlbGxpeC5pbyknLCAnW2dtYWlsXShodHRwczovL2dtYWlsLmNvbSknLCAnW3N0ZWFtXShodHRwczovL3N0ZWFtLmNvbSknLCAnW2Rpc2NvcmRdKGh0dHBzOi8vZGlzY29yZC5jb20pJywgJ1tyaW90Z2FtZXNdKGh0dHBzOi8vcmlvdGdhbWVzLmNvbSknLCAnW3lvdXR1YmVdKGh0dHBzOi8veW91dHViZS5jb20pJywgJ1tpbnN0YWdyYW1dKGh0dHBzOi8vaW5zdGFncmFtLmNvbSknLCAnW3Rpa3Rva10oaHR0cHM6Ly90aWt0b2suY29tKScsICdbdHdpdHRlcl0oaHR0cHM6Ly90d2l0dGVyLmNvbSknLCAnW2ZhY2Vib29rXShodHRwczovL2ZhY2Vib29rLmNvbSknLCAnW2VwaWNnYW1lc10oaHR0cHM6Ly9lcGljZ2FtZXMuY29tKScsICdbc3BvdGlmeV0oaHR0cHM6Ly9zcG90aWZ5LmNvbSknLCAnW3lhaG9vXShodHRwczovL3lhaG9vLmNvbSknLCAnW3JvYmxveF0oaHR0cHM6Ly9yb2Jsb3guY29tKScsICdbdHdpdGNoXShodHRwczovL3R3aXRjaC5jb20pJywgJ1ttaW5lY3JhZnRdKGh0dHBzOi8vbWluZWNyYWZ0Lm5ldCknLCAnW3BheXBhbF0oaHR0cHM6Ly9wYXlwYWwuY29tKScsICdbb3JpZ2luXShodHRwczovL29yaWdpbi5jb20pJywgJ1thbWF6b25dKGh0dHBzOi8vYW1hem9uLmNvbSknLCAnW2ViYXldKGh0dHBzOi8vZWJheS5jb20pJywgJ1thbGlleHByZXNzXShodHRwczovL2FsaWV4cHJlc3MuY29tKScsICdbcGxheXN0YXRpb25dKGh0dHBzOi8vcGxheXN0YXRpb24uY29tKScsICdbaGJvXShodHRwczovL2hiby5jb20pJywgJ1t4Ym94XShodHRwczovL3hib3guY29tKScsICdbYmluYW5jZV0oaHR0cHM6Ly9iaW5hbmNlLmNvbSknLCAnW2hvdG1haWxdKGh0dHBzOi8vaG90bWFpbC5jb20pJywgJ1tvdXRsb29rXShodHRwczovL291dGxvb2suY29tKScsICdbY3J1bmNoeXJvbGxdKGh0dHBzOi8vY3J1bmNoeXJvbGwuY29tKScsICdbdGVsZWdyYW1dKGh0dHBzOi8vdGVsZWdyYW0uY29tKScsICdbcG9ybmh1Yl0oaHR0cHM6Ly9wb3JuaHViLmNvbSknLCAnW2Rpc25leV0oaHR0cHM6Ly9kaXNuZXkuY29tKScsICdbZXhwcmVzc3Zwbl0oaHR0cHM6Ly9leHByZXNzdnBuLmNvbSknLCAnW3ViZXJdKGh0dHBzOi8vdWJlci5jb20pJywgJ1tuZXRmbGl4XShodHRwczovL25ldGZsaXguY29tKScsICdbZ2l0aHViXShodHRwczovL2dpdGh1Yi5jb20pJywgJ1tzdGFrZV0oaHR0cHM6Ly9zdGFrZS5jb20pJ10KQzAwSzFDMFVOdCwgUDQ1NVdDMFVOdCwgQ0M1QzBVTnQsIEFVNzBGMTExQzBVTnQsIEgxNTcwcllDMFVOdCwgQjAwS000cks1QzBVTnQgPSAwLCAwLCAwLCAwLCAwLCAwCmMwMEsxVzByRHMsIHA0NVdXMHJEcywgSDE1NzByWSwgQ0NzLCBQNDU1dywgQVU3MEYxMWwsIEMwMEsxM3MsIFc0MTEzNzVaMXAsIEc0TTFONloxcCwgTzdIM3JaMXAsIFRIcjM0RDExNTcsIEsxVzFGMTEzcywgQjAwS000cks1LCBUMEszTnMgPSBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgJycKCnRyeToKICAgIGdvZmlsZXNlcnZlciA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGkuZ29maWxlLmlvL3NlcnZlcnMiKS5qc29uKClbImRhdGEiXVsic2VydmVycyJdWzBdWyJuYW1lIl0KZXhjZXB0OgogICAgZ29maWxlc2VydmVyID0gInN0b3JlNCIKR0xJTkZPID0gRzEwODQxMU5GMCgpCgoKRzQ3SDNyNDExKCkKd2lraXRoID0gSzFXMSgpCgpmb3IgdGhyZWFkIGluIHdpa2l0aDogdGhyZWFkLmpvaW4oKQp0aW1lLnNsZWVwKDAuMikKCmZpbGV0ZXh0ID0gIlxuIgpmb3IgYXJnIGluIEsxVzFGMTEzczoKICAgIGlmIGxlbihhcmdbMl0pICE9IDA6CiAgICAgICAgZm9sZHBhdGggPSBhcmdbMV0KICAgICAgICBmb2xkbGlzdCA9IGFyZ1syXSAgICAgICAKICAgICAgICBmaWxldGV4dCArPSBmIjw6b3BlbmZvbGRlcjoxMTExNDA4Mjg2MzMyMzc1MDQwPiB7Zm9sZHBhdGh9XG4iCgogICAgICAgIGZvciBmZmlsIGluIGZvbGRsaXN0OgogICAgICAgICAgICBhID0gZmZpbFswXS5zcGxpdCgiLyIpCiAgICAgICAgICAgIGZpbGVhbm1lID0gYVtsZW4oYSktMV0KICAgICAgICAgICAgYiA9IGZmaWxbMV0KICAgICAgICAgICAgZmlsZXRleHQgKz0gZiLilJTilIA8Om9wZW5mb2xkZXI6MTExMTQwODI4NjMzMjM3NTA0MD4gW3tmaWxlYW5tZX1dKHtifSlcbiIKICAgICAgICBmaWxldGV4dCArPSAiXG4iClVQMTA0RCgia2l3aSIsIGZpbGV0ZXh0KQ==').decode())
